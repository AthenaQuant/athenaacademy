<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Master options basics for stock traders. Learn how to use options market data as an intelligence layer to improve stock and ETF trading decisions.">
    <title>8.1.1 Options Basics for Stock Traders | Quantitative Trading Mastery</title>

    <link rel="stylesheet" href="../../../assets/css/shared-styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <link rel="icon" href="../../../assets/images/logo.png" type="image/png">

    <style>
        .options-eq { font-size: 1.4rem; color: #10b981; text-align: center; padding: 20px; background: rgba(16, 185, 129, 0.1); border-radius: 12px; margin: 20px 0; border: 1px solid rgba(16, 185, 129, 0.3); }
        .metric-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin: 20px 0; }
        .metric-card { background: rgba(0,0,0,0.2); border-radius: 10px; padding: 15px; text-align: center; border: 1px solid rgba(148, 163, 184, 0.1); }
        .metric-value { font-size: 1.5rem; font-weight: bold; color: #10b981; }
        .metric-label { font-size: 0.85rem; color: #94a3b8; margin-top: 5px; }
        .options-table { width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 0.9rem; }
        .options-table th, .options-table td { padding: 12px; border: 1px solid rgba(148, 163, 184, 0.2); text-align: center; }
        .options-table th { background: rgba(99, 102, 241, 0.2); color: #a5b4fc; }
        .options-table tr:hover { background: rgba(99, 102, 241, 0.1); }
        .call-highlight { background: rgba(16, 185, 129, 0.15); }
        .put-highlight { background: rgba(239, 68, 68, 0.15); }
        .signal-bullish { color: #10b981; font-weight: bold; }
        .signal-bearish { color: #ef4444; font-weight: bold; }
        .signal-neutral { color: #f59e0b; font-weight: bold; }
        .intelligence-flow { display: flex; align-items: center; justify-content: center; gap: 20px; margin: 30px 0; flex-wrap: wrap; }
        .flow-step { background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.2)); padding: 20px; border-radius: 12px; text-align: center; min-width: 150px; }
        .flow-arrow { font-size: 2rem; color: #6366f1; }
        .calculator-section { background: rgba(0,0,0,0.3); border-radius: 16px; padding: 25px; margin: 25px 0; border: 1px solid rgba(99, 102, 241, 0.3); }
        .calc-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 15px 0; }
        .calc-input { background: rgba(0,0,0,0.3); border: 1px solid rgba(148, 163, 184, 0.3); border-radius: 8px; padding: 12px; color: #f1f5f9; width: 100%; }
        .calc-input:focus { outline: none; border-color: #6366f1; }
        .calc-btn { background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: transform 0.2s, box-shadow 0.2s; }
        .calc-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 20px rgba(99, 102, 241, 0.4); }
        .calc-result { background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 8px; padding: 15px; margin-top: 15px; }
        .moneyness-itm { color: #10b981; }
        .moneyness-atm { color: #f59e0b; }
        .moneyness-otm { color: #ef4444; }
        .chart-container { position: relative; height: 400px; }
        .chart-container canvas { max-height: 350px; }
        @media (max-width: 768px) {
            .metric-grid { grid-template-columns: repeat(2, 1fr); }
            .calc-grid { grid-template-columns: 1fr; }
            .intelligence-flow { flex-direction: column; }
            .flow-arrow { transform: rotate(90deg); }
        }
    </style>
</head>
<body>
    <nav class="module-nav-header">
        <div class="container">
            <div class="nav-content">
                <a href="../../../index.html" class="nav-home">‚Üê Back to Course</a>
                <div class="nav-module-info">
                    <span class="nav-module-number">Module 8.1.1</span>
                    <span class="nav-module-title">Options Basics for Stock Traders</span>
                </div>
                <a href="8.1.2_implied_volatility_fear_gauge.html" class="nav-next">Next Module ‚Üí</a>
            </div>
        </div>
    </nav>

    <header class="module-hero">
        <div class="container">
            <div class="module-hero-content">
                <div class="module-breadcrumb">
                    <span>Module 8: Options Market Intelligence</span>
                    <span class="breadcrumb-separator">‚Ä∫</span>
                    <span>8.1 Foundations</span>
                    <span class="breadcrumb-separator">‚Ä∫</span>
                    <span>8.1.1 Options Basics for Stock Traders</span>
                </div>
                <h1>Options Basics for Stock Traders</h1>
                <p class="module-subtitle">
                    Understanding the Intelligence Layer: Use options market data to gain 1-3 day advance notice of major stock moves.
                    This is NOT about trading options‚Äîit's about making better stock/ETF decisions.
                </p>
                <div class="module-meta">
                    <span class="meta-item">‚è±Ô∏è 45 min read</span>
                    <span class="meta-item">üìä 4 Visualizations</span>
                    <span class="meta-item">üíª Options Analyzer</span>
                    <span class="meta-item">‚úÖ 5 Quiz Questions</span>
                </div>
            </div>
        </div>
    </header>

    <main class="container content-wrapper">
        <!-- PART 1: WHY SHOULD I CARE? -->
        <section class="content-section fade-in">
            <h2>Part 1: Why Should I Care?</h2>

            <div class="info-box info-box-warning">
                <div class="info-box-title">The Hidden Intelligence Layer</div>
                <p>
                    You buy AAPL stock at $180. The next day it drops to $170. What you didn't know: institutions were buying
                    <strong>massive put protection</strong> the day before‚Äîa clear bearish signal. The options market showed their
                    positioning BEFORE it showed up in the stock price.
                </p>
            </div>

            <div class="options-eq">
                Options Activity ‚Üí Institutional Positioning ‚Üí Stock Price Movement
            </div>
            <p style="text-align: center; color: #94a3b8;">Options data gives you a 1-3 day advance notice of major moves</p>

            <div class="card-grid">
                <div class="card">
                    <h4>Early Warning System</h4>
                    <p>Heavy put buying often precedes stock declines by 1-3 days. Missing these signals costs 5-10% on trades.</p>
                </div>
                <div class="card">
                    <h4>Institutional Footprints</h4>
                    <p>Large players must hedge in options markets. Their positioning is visible before stock moves occur.</p>
                </div>
                <div class="card">
                    <h4>Sentiment Gauge</h4>
                    <p>Put/Call ratios reveal market fear and greed levels‚Äîextreme readings predict reversals.</p>
                </div>
                <div class="card">
                    <h4>Price Level Intelligence</h4>
                    <p>Heavy open interest at specific strikes creates support/resistance levels. Markets "pin" to these levels.</p>
                </div>
            </div>

            <div class="info-box">
                <div class="info-box-title">Real Example: GameStop January 2021</div>
                <p>
                    Unusual call activity appeared <strong>weeks before</strong> the famous squeeze. Traders monitoring options flow
                    saw massive call buying at $20-40 strikes when GME was trading at $15. This was the early warning‚Äîthose who
                    understood options intelligence positioned early and captured 10x+ gains.
                </p>
            </div>

            <div class="metric-grid">
                <div class="metric-card">
                    <div class="metric-value">1-3 Days</div>
                    <div class="metric-label">Advance Warning</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">5-10%</div>
                    <div class="metric-label">Avoided Losses</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">$Billions</div>
                    <div class="metric-label">Daily Options Volume</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">24/7</div>
                    <div class="metric-label">Intelligence Available</div>
                </div>
            </div>
        </section>

        <!-- PART 2: BUILDING INTUITION -->
        <section class="content-section fade-in">
            <h2>Part 2: Building Intuition</h2>

            <div class="info-box">
                <div class="info-box-title">What Are Options? (For Stock Traders)</div>
                <p>
                    Think of options as <strong>bets on future stock price movements</strong>. You don't need to trade them‚Äîyou just
                    need to understand what the bets tell you about where smart money thinks the stock is going.
                </p>
            </div>

            <!-- SVG Diagram: Options as Bets -->
            <div style="text-align: center; margin: 30px 0;">
                <svg viewBox="0 0 800 300" style="max-width: 100%; height: auto;">
                    <defs>
                        <linearGradient id="callGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#10b981;stop-opacity:0.8" />
                            <stop offset="100%" style="stop-color:#059669;stop-opacity:0.8" />
                        </linearGradient>
                        <linearGradient id="putGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#ef4444;stop-opacity:0.8" />
                            <stop offset="100%" style="stop-color:#dc2626;stop-opacity:0.8" />
                        </linearGradient>
                        <linearGradient id="stockGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#6366f1;stop-opacity:0.8" />
                            <stop offset="100%" style="stop-color:#4f46e5;stop-opacity:0.8" />
                        </linearGradient>
                    </defs>

                    <!-- Stock Price Center -->
                    <rect x="325" y="100" width="150" height="80" rx="10" fill="url(#stockGrad)" />
                    <text x="400" y="135" text-anchor="middle" fill="white" font-size="14" font-weight="bold">STOCK PRICE</text>
                    <text x="400" y="160" text-anchor="middle" fill="white" font-size="20" font-weight="bold">$180</text>

                    <!-- Call Options (Left - Bullish) -->
                    <rect x="50" y="100" width="200" height="80" rx="10" fill="url(#callGrad)" />
                    <text x="150" y="130" text-anchor="middle" fill="white" font-size="14" font-weight="bold">CALL OPTIONS</text>
                    <text x="150" y="155" text-anchor="middle" fill="white" font-size="12">Bullish Bet</text>
                    <text x="150" y="175" text-anchor="middle" fill="white" font-size="11">"Stock will go UP"</text>

                    <!-- Put Options (Right - Bearish) -->
                    <rect x="550" y="100" width="200" height="80" rx="10" fill="url(#putGrad)" />
                    <text x="650" y="130" text-anchor="middle" fill="white" font-size="14" font-weight="bold">PUT OPTIONS</text>
                    <text x="650" y="155" text-anchor="middle" fill="white" font-size="12">Bearish Bet</text>
                    <text x="650" y="175" text-anchor="middle" fill="white" font-size="11">"Stock will go DOWN"</text>

                    <!-- Arrows -->
                    <path d="M250 140 L320 140" stroke="#10b981" stroke-width="3" fill="none" marker-end="url(#arrowGreen)"/>
                    <path d="M480 140 L550 140" stroke="#ef4444" stroke-width="3" fill="none" marker-end="url(#arrowRed)"/>

                    <!-- Arrow markers -->
                    <defs>
                        <marker id="arrowGreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#10b981" />
                        </marker>
                        <marker id="arrowRed" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#ef4444" />
                        </marker>
                    </defs>

                    <!-- Signal Labels -->
                    <text x="150" y="220" text-anchor="middle" fill="#10b981" font-size="12" font-weight="bold">Heavy Call Buying =</text>
                    <text x="150" y="240" text-anchor="middle" fill="#10b981" font-size="12">Institutions BULLISH</text>
                    <text x="150" y="260" text-anchor="middle" fill="#94a3b8" font-size="11">Stock likely to RISE</text>

                    <text x="650" y="220" text-anchor="middle" fill="#ef4444" font-size="12" font-weight="bold">Heavy Put Buying =</text>
                    <text x="650" y="240" text-anchor="middle" fill="#ef4444" font-size="12">Institutions BEARISH/HEDGING</text>
                    <text x="650" y="260" text-anchor="middle" fill="#94a3b8" font-size="11">Investigate context!</text>
                </svg>
            </div>

            <div class="card-grid">
                <div class="card">
                    <h4>Call Option</h4>
                    <p><strong>Bullish bet</strong> - Buyer expects stock to go UP above the strike price before expiration.</p>
                    <div class="highlight">Signal: Heavy call buying = bullish positioning</div>
                </div>
                <div class="card">
                    <h4>Put Option</h4>
                    <p><strong>Bearish bet or protection</strong> - Buyer expects stock to go DOWN or is hedging existing positions.</p>
                    <div class="highlight">Signal: Heavy put buying = bearish OR protective</div>
                </div>
                <div class="card">
                    <h4>Strike Price</h4>
                    <p>The price level institutions are betting on. Heavy activity at $200 strike = they think stock reaches $200.</p>
                    <div class="highlight">Key price level intelligence</div>
                </div>
                <div class="card">
                    <h4>Expiration</h4>
                    <p>How long they think the move will take. Near-term = expecting imminent move. Long-term = structural bet.</p>
                    <div class="highlight">Timing intelligence</div>
                </div>
            </div>

            <div class="card-grid">
                <div class="card">
                    <h4>Premium</h4>
                    <p>Price paid for the option. Higher premium = more confidence in the bet. Shows conviction level.</p>
                    <div class="highlight">Confidence indicator</div>
                </div>
                <div class="card">
                    <h4>Volume</h4>
                    <p><strong>NEW activity today</strong> - Fresh bets being placed. Spike in volume = new positioning happening NOW.</p>
                    <div class="highlight">Real-time flow signal</div>
                </div>
                <div class="card">
                    <h4>Open Interest (OI)</h4>
                    <p><strong>EXISTING positions</strong> - Total contracts outstanding. High OI at a strike = significant price level.</p>
                    <div class="highlight">Accumulated positioning</div>
                </div>
                <div class="card">
                    <h4>Volume/OI Ratio</h4>
                    <p>High ratio = unusual activity. If volume >> OI, something big is happening today.</p>
                    <div class="highlight">Unusual activity detector</div>
                </div>
            </div>

            <div class="info-box info-box-warning">
                <div class="info-box-title">Key Insight for Stock Traders</div>
                <p>
                    <strong>Institutions move markets, retail follows.</strong> Big players (hedge funds, pension funds, market makers)
                    must hedge their positions in options markets. Their activity shows up there FIRST, then moves the stock 1-3 days later.
                    You're reading their playbook before they execute.
                </p>
            </div>
        </section>

        <!-- PART 3: THE MATHEMATICS -->
        <section class="content-section fade-in">
            <h2>Part 3: The Mathematics</h2>

            <div class="formula-box">
                <h3>Intrinsic Value (Call Option)</h3>
                <div class="formula">Intrinsic Value<sub>call</sub> = max(Stock Price - Strike Price, 0)</div>
                <p>How much the option is "in the money" - the guaranteed value if exercised right now</p>
            </div>

            <div class="formula-box">
                <h3>Intrinsic Value (Put Option)</h3>
                <div class="formula">Intrinsic Value<sub>put</sub> = max(Strike Price - Stock Price, 0)</div>
                <p>For puts, value comes from stock being BELOW the strike price</p>
            </div>

            <div class="formula-box">
                <h3>Option Premium Breakdown</h3>
                <div class="formula">Total Premium = Intrinsic Value + Extrinsic Value (Time Value)</div>
                <p>Extrinsic value = what traders pay for the POTENTIAL of the option. Higher extrinsic = more uncertainty/potential.</p>
            </div>

            <h3>Moneyness Classification</h3>
            <table class="options-table">
                <thead>
                    <tr>
                        <th>Classification</th>
                        <th>Call Option</th>
                        <th>Put Option</th>
                        <th>Trading Signal</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="call-highlight">
                        <td><span class="moneyness-itm">ITM (In The Money)</span></td>
                        <td>Stock > Strike</td>
                        <td>Stock < Strike</td>
                        <td>Intrinsic value > 0, more expensive</td>
                    </tr>
                    <tr>
                        <td><span class="moneyness-atm">ATM (At The Money)</span></td>
                        <td>Stock ‚âà Strike</td>
                        <td>Stock ‚âà Strike</td>
                        <td>Most liquid, highest time value</td>
                    </tr>
                    <tr class="put-highlight">
                        <td><span class="moneyness-otm">OTM (Out of The Money)</span></td>
                        <td>Stock < Strike</td>
                        <td>Stock > Strike</td>
                        <td>Cheaper, pure directional bet</td>
                    </tr>
                </tbody>
            </table>

            <div class="formula-box">
                <h3>Volume vs Open Interest Interpretation</h3>
                <div class="formula">
                    High Volume + Rising OI = New positions being OPENED<br>
                    High Volume + Falling OI = Positions being CLOSED
                </div>
                <p>New positions = fresh conviction. Closing positions = taking profits or cutting losses.</p>
            </div>

            <h3>Numerical Example: AAPL Options Chain</h3>
            <p>AAPL trading at <strong>$180</strong>. Let's analyze three strikes:</p>

            <table class="options-table">
                <thead>
                    <tr>
                        <th>Strike</th>
                        <th>Type</th>
                        <th>Premium</th>
                        <th>Intrinsic</th>
                        <th>Extrinsic</th>
                        <th>Moneyness</th>
                        <th>Volume</th>
                        <th>Open Interest</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="call-highlight">
                        <td>$170</td>
                        <td>Call</td>
                        <td>$15.50</td>
                        <td>$10.00</td>
                        <td>$5.50</td>
                        <td class="moneyness-itm">ITM</td>
                        <td>5,000</td>
                        <td>10,000</td>
                    </tr>
                    <tr>
                        <td>$180</td>
                        <td>Call</td>
                        <td>$7.80</td>
                        <td>$0.00</td>
                        <td>$7.80</td>
                        <td class="moneyness-atm">ATM</td>
                        <td>12,000</td>
                        <td>20,000</td>
                    </tr>
                    <tr class="put-highlight">
                        <td>$190</td>
                        <td>Call</td>
                        <td>$2.10</td>
                        <td>$0.00</td>
                        <td>$2.10</td>
                        <td class="moneyness-otm">OTM</td>
                        <td>25,000</td>
                        <td>8,000</td>
                    </tr>
                </tbody>
            </table>

            <div class="info-box">
                <div class="info-box-title">What Does This Tell Us?</div>
                <p>
                    <strong>Massive volume at $190 OTM calls</strong> (25,000 contracts vs 8,000 OI = 3.1x ratio). This is unusual activity!
                    Someone is making a big bet that AAPL reaches $190 soon. The Vol/OI ratio of 3.1x suggests new aggressive bullish positioning.
                    <br><br>
                    <span class="signal-bullish">SIGNAL: Bullish positioning detected. Consider adding AAPL to watchlist for long entry.</span>
                </p>
            </div>
        </section>

        <!-- PART 4: NUMERICAL EXAMPLE -->
        <section class="content-section fade-in">
            <h2>Part 4: Step-by-Step Interpretation</h2>

            <div class="info-box">
                <div class="info-box-title">Complete Worked Example: Reading AAPL Options for Stock Trading</div>
                <p>Let's walk through exactly how a stock trader would interpret options data to make better decisions.</p>
            </div>

            <h3>Scenario: Should You Buy AAPL Stock?</h3>
            <p>AAPL is trading at <strong>$180</strong>. Your technical analysis is neutral. Let's check options intelligence.</p>

            <h4>Step 1: Check Overall Put/Call Activity</h4>
            <table class="options-table">
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th>Calls</th>
                        <th>Puts</th>
                        <th>Interpretation</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Today's Volume</td>
                        <td>45,000</td>
                        <td>15,000</td>
                        <td class="signal-bullish">3:1 Call/Put = Very Bullish</td>
                    </tr>
                    <tr>
                        <td>Open Interest</td>
                        <td>120,000</td>
                        <td>80,000</td>
                        <td>Existing bullish bias</td>
                    </tr>
                </tbody>
            </table>

            <h4>Step 2: Identify Unusual Activity</h4>
            <div class="metric-grid">
                <div class="metric-card">
                    <div class="metric-value">$190 Call</div>
                    <div class="metric-label">25,000 Volume</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">3.1x</div>
                    <div class="metric-label">Vol/OI Ratio</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">OTM</div>
                    <div class="metric-label">Aggressive Bet</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value signal-bullish">BULLISH</div>
                    <div class="metric-label">Signal</div>
                </div>
            </div>

            <h4>Step 3: Check for Hedging (Puts)</h4>
            <table class="options-table">
                <thead>
                    <tr>
                        <th>Strike</th>
                        <th>Put Volume</th>
                        <th>Put OI</th>
                        <th>Vol/OI</th>
                        <th>Interpretation</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>$175</td>
                        <td>3,000</td>
                        <td>15,000</td>
                        <td>0.2x</td>
                        <td>Normal activity</td>
                    </tr>
                    <tr>
                        <td>$170</td>
                        <td>5,000</td>
                        <td>25,000</td>
                        <td>0.2x</td>
                        <td>Normal activity</td>
                    </tr>
                    <tr>
                        <td>$165</td>
                        <td>2,000</td>
                        <td>10,000</td>
                        <td>0.2x</td>
                        <td>Normal activity</td>
                    </tr>
                </tbody>
            </table>
            <p><span class="signal-bullish">No unusual put buying</span> - Institutions are NOT hedging aggressively. This confirms bullish stance.</p>

            <h4>Step 4: Final Signal for Stock Trading</h4>
            <div class="calc-result">
                <h4 style="color: #10b981; margin-bottom: 10px;">TRADING SIGNAL: BULLISH</h4>
                <p><strong>Evidence:</strong></p>
                <ul style="margin-left: 20px;">
                    <li>3:1 Call/Put volume ratio (very bullish)</li>
                    <li>Unusual call activity at $190 strike (3.1x Vol/OI)</li>
                    <li>No unusual put hedging detected</li>
                    <li>Existing bullish open interest bias</li>
                </ul>
                <p style="margin-top: 15px;"><strong>Action:</strong> Add AAPL to bullish watchlist. Look for technical entry (support bounce, breakout, etc.). Options intelligence confirms bullish bias‚Äînow find your entry!</p>
            </div>
        </section>

        <!-- PART 5: PYTHON IMPLEMENTATION -->
        <section class="content-section fade-in">
            <h2>Part 5: Python Implementation</h2>

            <div class="info-box">
                <div class="info-box-title">Production-Quality Options Analysis</div>
                <p>Complete Python code with type hints and docstrings for analyzing options data to generate stock trading signals.</p>
            </div>

            <div class="code-block">
                <div class="code-header">
                    <span>options_intelligence.py</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre><code class="language-python">"""
Options Intelligence Module for Stock Traders

This module provides tools to analyze options market data and generate
trading signals for stocks and ETFs. NOT for trading options directly.

Author: Quantitative Trading Mastery
"""

import pandas as pd
import numpy as np
from typing import Dict, List, Optional, Tuple, Literal
from dataclasses import dataclass
from datetime import datetime


@dataclass
class OptionsSignal:
    """Container for options-derived trading signals."""
    signal: Literal["BULLISH", "BEARISH", "NEUTRAL"]
    strength: Literal["STRONG", "MODERATE", "WEAK"]
    confidence: float  # 0-1
    reasons: List[str]
    volume_pc_ratio: float
    oi_pc_ratio: float


def calculate_intrinsic_value(
    option_type: str,
    stock_price: float,
    strike_price: float
) -> float:
    """
    Calculate intrinsic value of an option.

    Parameters
    ----------
    option_type : str
        Either 'call' or 'put'
    stock_price : float
        Current stock price
    strike_price : float
        Option strike price

    Returns
    -------
    float
        Intrinsic value (always >= 0)

    Examples
    --------
    >>> calculate_intrinsic_value('call', 180, 170)
    10.0
    >>> calculate_intrinsic_value('put', 180, 190)
    10.0
    >>> calculate_intrinsic_value('call', 180, 190)
    0.0
    """
    if option_type.lower() == 'call':
        return max(stock_price - strike_price, 0.0)
    elif option_type.lower() == 'put':
        return max(strike_price - stock_price, 0.0)
    else:
        raise ValueError("option_type must be 'call' or 'put'")


def calculate_extrinsic_value(
    premium: float,
    intrinsic_value: float
) -> float:
    """
    Calculate extrinsic (time) value of an option.

    Parameters
    ----------
    premium : float
        Total option premium (market price)
    intrinsic_value : float
        Calculated intrinsic value

    Returns
    -------
    float
        Extrinsic value (time value)
    """
    return max(premium - intrinsic_value, 0.0)


def classify_moneyness(
    option_type: str,
    stock_price: float,
    strike_price: float,
    threshold: float = 0.02
) -> str:
    """
    Classify option moneyness (ITM, ATM, OTM).

    Parameters
    ----------
    option_type : str
        Either 'call' or 'put'
    stock_price : float
        Current stock price
    strike_price : float
        Option strike price
    threshold : float
        Percentage threshold for ATM classification (default 2%)

    Returns
    -------
    str
        'ITM', 'ATM', or 'OTM'

    Examples
    --------
    >>> classify_moneyness('call', 180, 170)
    'ITM'
    >>> classify_moneyness('call', 180, 180)
    'ATM'
    >>> classify_moneyness('call', 180, 190)
    'OTM'
    """
    pct_diff = abs(stock_price - strike_price) / stock_price

    if pct_diff <= threshold:
        return 'ATM'

    if option_type.lower() == 'call':
        return 'ITM' if stock_price > strike_price else 'OTM'
    else:  # put
        return 'ITM' if stock_price < strike_price else 'OTM'


def analyze_options_chain(
    options_data: pd.DataFrame,
    stock_price: float
) -> pd.DataFrame:
    """
    Analyze options chain and flag unusual activity.

    Parameters
    ----------
    options_data : pd.DataFrame
        Options chain with columns: strike, type, volume, open_interest, premium
    stock_price : float
        Current stock price

    Returns
    -------
    pd.DataFrame
        Analyzed options chain with additional columns:
        - intrinsic_value
        - extrinsic_value
        - moneyness
        - vol_oi_ratio
        - unusual_activity (bool)

    Examples
    --------
    >>> data = pd.DataFrame({
    ...     'strike': [170, 180, 190],
    ...     'type': ['call', 'call', 'call'],
    ...     'volume': [5000, 12000, 25000],
    ...     'open_interest': [10000, 20000, 8000],
    ...     'premium': [15.50, 7.80, 2.10]
    ... })
    >>> analyzed = analyze_options_chain(data, 180)
    >>> analyzed['unusual_activity'].tolist()
    [False, False, True]
    """
    df = options_data.copy()

    # Calculate intrinsic value for each option
    df['intrinsic_value'] = df.apply(
        lambda row: calculate_intrinsic_value(
            row['type'],
            stock_price,
            row['strike']
        ),
        axis=1
    )

    # Calculate extrinsic value
    df['extrinsic_value'] = df.apply(
        lambda row: calculate_extrinsic_value(
            row['premium'],
            row['intrinsic_value']
        ),
        axis=1
    )

    # Classify moneyness
    df['moneyness'] = df.apply(
        lambda row: classify_moneyness(
            row['type'],
            stock_price,
            row['strike']
        ),
        axis=1
    )

    # Calculate volume/OI ratio (unusual activity indicator)
    df['vol_oi_ratio'] = df['volume'] / df['open_interest'].replace(0, np.nan)
    df['vol_oi_ratio'] = df['vol_oi_ratio'].fillna(0)

    # Flag unusual activity (volume > 2x OI or volume > 3x average)
    avg_volume = df['volume'].mean()
    df['unusual_activity'] = (
        (df['vol_oi_ratio'] > 2.0) |
        (df['volume'] > 3 * avg_volume)
    )

    return df


def interpret_options_signal(
    calls_volume: int,
    puts_volume: int,
    calls_oi: int,
    puts_oi: int,
    unusual_calls: bool = False,
    unusual_puts: bool = False
) -> OptionsSignal:
    """
    Interpret options activity for stock trading signals.

    Parameters
    ----------
    calls_volume : int
        Total call volume
    puts_volume : int
        Total put volume
    calls_oi : int
        Total call open interest
    puts_oi : int
        Total put open interest
    unusual_calls : bool
        Whether unusual call activity detected
    unusual_puts : bool
        Whether unusual put activity detected

    Returns
    -------
    OptionsSignal
        Signal interpretation with strength and reasons

    Examples
    --------
    >>> signal = interpret_options_signal(45000, 15000, 120000, 80000, True, False)
    >>> signal.signal
    'BULLISH'
    >>> signal.strength
    'STRONG'
    """
    reasons = []

    # Calculate ratios
    volume_pc_ratio = puts_volume / calls_volume if calls_volume > 0 else 0
    oi_pc_ratio = puts_oi / calls_oi if calls_oi > 0 else 0

    # Initialize scoring
    bullish_score = 0
    bearish_score = 0

    # Volume P/C ratio analysis
    if volume_pc_ratio < 0.5:
        bullish_score += 2
        reasons.append(f"Low P/C volume ratio ({volume_pc_ratio:.2f}) = bullish flow")
    elif volume_pc_ratio < 0.7:
        bullish_score += 1
        reasons.append(f"Below-average P/C ratio ({volume_pc_ratio:.2f})")
    elif volume_pc_ratio > 1.5:
        bearish_score += 2
        reasons.append(f"High P/C volume ratio ({volume_pc_ratio:.2f}) = bearish/hedging")
    elif volume_pc_ratio > 1.0:
        bearish_score += 1
        reasons.append(f"Above-average P/C ratio ({volume_pc_ratio:.2f})")

    # Unusual activity analysis
    if unusual_calls and not unusual_puts:
        bullish_score += 2
        reasons.append("Unusual CALL activity detected")
    elif unusual_puts and not unusual_calls:
        bearish_score += 2
        reasons.append("Unusual PUT activity detected")
    elif unusual_calls and unusual_puts:
        reasons.append("Unusual activity on BOTH sides - volatility expected")

    # OI bias
    if oi_pc_ratio < 0.7:
        bullish_score += 1
        reasons.append("Existing bullish open interest bias")
    elif oi_pc_ratio > 1.3:
        bearish_score += 1
        reasons.append("Existing bearish open interest bias")

    # Determine signal
    net_score = bullish_score - bearish_score

    if net_score >= 3:
        signal = "BULLISH"
        strength = "STRONG"
        confidence = min(0.9, 0.5 + net_score * 0.1)
    elif net_score >= 1:
        signal = "BULLISH"
        strength = "MODERATE"
        confidence = 0.5 + net_score * 0.1
    elif net_score <= -3:
        signal = "BEARISH"
        strength = "STRONG"
        confidence = min(0.9, 0.5 + abs(net_score) * 0.1)
    elif net_score <= -1:
        signal = "BEARISH"
        strength = "MODERATE"
        confidence = 0.5 + abs(net_score) * 0.1
    else:
        signal = "NEUTRAL"
        strength = "WEAK"
        confidence = 0.4
        reasons.append("Mixed signals - no clear direction")

    return OptionsSignal(
        signal=signal,
        strength=strength,
        confidence=round(confidence, 2),
        reasons=reasons,
        volume_pc_ratio=round(volume_pc_ratio, 2),
        oi_pc_ratio=round(oi_pc_ratio, 2)
    )


def find_key_strikes(
    options_data: pd.DataFrame,
    stock_price: float,
    top_n: int = 5
) -> Dict[str, List[Tuple[float, int]]]:
    """
    Find key strike levels based on open interest concentration.

    Parameters
    ----------
    options_data : pd.DataFrame
        Options chain with columns: strike, type, open_interest
    stock_price : float
        Current stock price
    top_n : int
        Number of top strikes to return

    Returns
    -------
    Dict[str, List[Tuple[float, int]]]
        Dictionary with 'resistance' (call OI above) and 'support' (put OI below)
    """
    calls = options_data[options_data['type'] == 'call']
    puts = options_data[options_data['type'] == 'put']

    # Resistance: Heavy call OI above current price
    call_above = calls[calls['strike'] > stock_price]
    resistance = (
        call_above.nlargest(top_n, 'open_interest')[['strike', 'open_interest']]
        .values.tolist()
    )

    # Support: Heavy put OI below current price
    put_below = puts[puts['strike'] < stock_price]
    support = (
        put_below.nlargest(top_n, 'open_interest')[['strike', 'open_interest']]
        .values.tolist()
    )

    return {
        'resistance': [(float(s), int(oi)) for s, oi in resistance],
        'support': [(float(s), int(oi)) for s, oi in support]
    }


# ============================================================
# EXAMPLE USAGE
# ============================================================

if __name__ == "__main__":
    # Example: Analyze AAPL options chain
    print("=" * 60)
    print("OPTIONS INTELLIGENCE ANALYSIS - AAPL")
    print("=" * 60)

    # Create sample options data
    aapl_calls = pd.DataFrame({
        'strike': [170, 175, 180, 185, 190, 195],
        'type': ['call'] * 6,
        'volume': [5000, 8000, 12000, 6000, 25000, 3000],
        'open_interest': [10000, 15000, 20000, 8000, 8000, 5000],
        'premium': [15.50, 11.20, 7.80, 4.50, 2.10, 0.80]
    })

    aapl_puts = pd.DataFrame({
        'strike': [165, 170, 175, 180, 185],
        'type': ['put'] * 5,
        'volume': [2000, 5000, 3000, 4000, 1000],
        'open_interest': [10000, 25000, 15000, 12000, 5000],
        'premium': [0.50, 1.20, 2.50, 5.00, 8.50]
    })

    options_data = pd.concat([aapl_calls, aapl_puts], ignore_index=True)
    stock_price = 180

    # Analyze chain
    print(f"\nStock Price: ${stock_price}")
    print("-" * 60)

    analyzed = analyze_options_chain(options_data, stock_price)

    print("\nOPTIONS CHAIN ANALYSIS:")
    print(analyzed[['strike', 'type', 'volume', 'open_interest',
                    'moneyness', 'vol_oi_ratio', 'unusual_activity']]
          .to_string(index=False))

    # Find unusual activity
    unusual = analyzed[analyzed['unusual_activity']]
    if not unusual.empty:
        print("\n‚ö†Ô∏è  UNUSUAL ACTIVITY DETECTED:")
        for _, row in unusual.iterrows():
            print(f"   {row['type'].upper()} ${row['strike']} - "
                  f"Volume: {row['volume']:,}, Vol/OI: {row['vol_oi_ratio']:.1f}x")

    # Generate trading signal
    calls_vol = analyzed[analyzed['type'] == 'call']['volume'].sum()
    puts_vol = analyzed[analyzed['type'] == 'put']['volume'].sum()
    calls_oi = analyzed[analyzed['type'] == 'call']['open_interest'].sum()
    puts_oi = analyzed[analyzed['type'] == 'put']['open_interest'].sum()

    unusual_calls = not analyzed[(analyzed['type'] == 'call') &
                                  (analyzed['unusual_activity'])].empty
    unusual_puts = not analyzed[(analyzed['type'] == 'put') &
                                 (analyzed['unusual_activity'])].empty

    signal = interpret_options_signal(
        calls_vol, puts_vol, calls_oi, puts_oi,
        unusual_calls, unusual_puts
    )

    print("\n" + "=" * 60)
    print("TRADING SIGNAL")
    print("=" * 60)
    print(f"Signal: {signal.signal} ({signal.strength})")
    print(f"Confidence: {signal.confidence:.0%}")
    print(f"P/C Volume Ratio: {signal.volume_pc_ratio}")
    print(f"P/C OI Ratio: {signal.oi_pc_ratio}")
    print("\nReasons:")
    for reason in signal.reasons:
        print(f"  ‚Ä¢ {reason}")

    # Find key support/resistance
    key_levels = find_key_strikes(options_data, stock_price)
    print("\n" + "-" * 60)
    print("KEY PRICE LEVELS FROM OPTIONS:")
    print(f"  Resistance (Call OI): {key_levels['resistance'][:3]}")
    print(f"  Support (Put OI): {key_levels['support'][:3]}")
</code></pre>
            </div>

            <h3>Sample Output</h3>
            <div class="code-block">
                <div class="code-header">
                    <span>Console Output</span>
                </div>
                <pre><code class="language-text">============================================================
OPTIONS INTELLIGENCE ANALYSIS - AAPL
============================================================

Stock Price: $180
------------------------------------------------------------

OPTIONS CHAIN ANALYSIS:
strike  type  volume  open_interest moneyness  vol_oi_ratio  unusual_activity
   170  call    5000          10000       ITM          0.50             False
   175  call    8000          15000       ITM          0.53             False
   180  call   12000          20000       ATM          0.60             False
   185  call    6000           8000       OTM          0.75             False
   190  call   25000           8000       OTM          3.12              True
   195  call    3000           5000       OTM          0.60             False
   165   put    2000          10000       OTM          0.20             False
   170   put    5000          25000       OTM          0.20             False
   175   put    3000          15000       OTM          0.20             False
   180   put    4000          12000       ATM          0.33             False
   185   put    1000           5000       ITM          0.20             False

‚ö†Ô∏è  UNUSUAL ACTIVITY DETECTED:
   CALL $190 - Volume: 25,000, Vol/OI: 3.1x

============================================================
TRADING SIGNAL
============================================================
Signal: BULLISH (STRONG)
Confidence: 80%
P/C Volume Ratio: 0.25
P/C OI Ratio: 1.02

Reasons:
  ‚Ä¢ Low P/C volume ratio (0.25) = bullish flow
  ‚Ä¢ Unusual CALL activity detected
  ‚Ä¢ Existing bullish open interest bias

------------------------------------------------------------
KEY PRICE LEVELS FROM OPTIONS:
  Resistance (Call OI): [(180.0, 20000), (175.0, 15000), (170.0, 10000)]
  Support (Put OI): [(170.0, 25000), (175.0, 15000), (180.0, 12000)]</code></pre>
            </div>
        </section>

        <!-- PART 6: TRADING APPLICATIONS -->
        <section class="content-section fade-in">
            <h2>Part 6: Trading Applications</h2>

            <div class="info-box">
                <div class="info-box-title">Professional Workflow: Options ‚Üí Stock Trading</div>
                <p>Here's how professional traders use options intelligence to make better stock/ETF decisions.</p>
            </div>

            <div class="intelligence-flow">
                <div class="flow-step">
                    <h4>1. Scan</h4>
                    <p>Options unusual activity scanner</p>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-step">
                    <h4>2. Filter</h4>
                    <p>Add to stock watchlist</p>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-step">
                    <h4>3. Confirm</h4>
                    <p>Technical analysis</p>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-step">
                    <h4>4. Execute</h4>
                    <p>Enter stock position</p>
                </div>
            </div>

            <div class="card-grid">
                <div class="card">
                    <h4>Pre-Market Analysis</h4>
                    <p>Check previous day's unusual activity. Heavy call buying overnight = potential gap up. Add to morning watchlist.</p>
                    <div class="highlight">Best time: 8:00-9:30 AM</div>
                </div>
                <div class="card">
                    <h4>Intraday Momentum</h4>
                    <p>Monitor real-time options flow. Sudden surge in calls = momentum confirmation. Use for entry timing.</p>
                    <div class="highlight">Real-time flow watching</div>
                </div>
                <div class="card">
                    <h4>Swing Trading</h4>
                    <p>Heavy institutional call buying = potential multi-day rally. Look for 3+ days of consistent bullish flow.</p>
                    <div class="highlight">Hold 2-10 days</div>
                </div>
                <div class="card">
                    <h4>Earnings Intelligence</h4>
                    <p>Unusual activity 2-3 days before earnings = informed positioning. Direction hints at expected move.</p>
                    <div class="highlight">High conviction plays</div>
                </div>
            </div>

            <h3>Real Example: TSLA Swing Trade</h3>
            <table class="options-table">
                <thead>
                    <tr>
                        <th>Day</th>
                        <th>Stock Price</th>
                        <th>Options Signal</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Monday</td>
                        <td>$240</td>
                        <td class="signal-bullish">Unusual call activity at $260 strike</td>
                        <td>Add to watchlist</td>
                    </tr>
                    <tr>
                        <td>Tuesday</td>
                        <td>$242</td>
                        <td class="signal-bullish">Continued call buying, P/C = 0.3</td>
                        <td>Look for entry</td>
                    </tr>
                    <tr>
                        <td>Wednesday</td>
                        <td>$238</td>
                        <td class="signal-bullish">Dip bought with calls, support holds</td>
                        <td>BUY at $238</td>
                    </tr>
                    <tr>
                        <td>Thursday</td>
                        <td>$248</td>
                        <td class="signal-bullish">Bullish flow continues</td>
                        <td>Hold position</td>
                    </tr>
                    <tr>
                        <td>Friday</td>
                        <td>$258</td>
                        <td class="signal-neutral">Flow normalizing near target</td>
                        <td>SELL at $258 (+8.4%)</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- PART 7: COMMON MISTAKES -->
        <section class="content-section fade-in">
            <h2>Part 7: Common Mistakes</h2>

            <div class="card-grid">
                <div class="card" style="border-left: 4px solid #ef4444;">
                    <h4>‚ùå Copying Options Trades</h4>
                    <p>You're a STOCK trader. Don't buy the options themselves‚Äîuse the data to trade the underlying stock/ETF.</p>
                    <div class="highlight" style="background: rgba(239, 68, 68, 0.2); color: #fca5a5;">Options are intelligence, not the trade</div>
                </div>
                <div class="card" style="border-left: 4px solid #ef4444;">
                    <h4>‚ùå Ignoring Context</h4>
                    <p>Heavy put buying could be HEDGING existing long positions, not bearish bets. Always check if it's protective or speculative.</p>
                    <div class="highlight" style="background: rgba(239, 68, 68, 0.2); color: #fca5a5;">Context matters!</div>
                </div>
                <div class="card" style="border-left: 4px solid #ef4444;">
                    <h4>‚ùå Volume Without OI</h4>
                    <p>High volume alone means nothing. You need the Vol/OI ratio to identify truly unusual activity (>2x is significant).</p>
                    <div class="highlight" style="background: rgba(239, 68, 68, 0.2); color: #fca5a5;">Always check both metrics</div>
                </div>
                <div class="card" style="border-left: 4px solid #ef4444;">
                    <h4>‚ùå Illiquid Stocks</h4>
                    <p>Options data on illiquid stocks is unreliable. Stick to liquid names: SPY, QQQ, AAPL, MSFT, TSLA, etc.</p>
                    <div class="highlight" style="background: rgba(239, 68, 68, 0.2); color: #fca5a5;">Liquidity is king</div>
                </div>
            </div>

            <div class="card-grid">
                <div class="card" style="border-left: 4px solid #10b981;">
                    <h4>‚úÖ Use as ONE Signal</h4>
                    <p>Options intelligence is a confirmation tool. Combine with technical analysis, fundamentals, and volume for best results.</p>
                    <div class="highlight">Part of the toolkit, not the whole toolkit</div>
                </div>
                <div class="card" style="border-left: 4px solid #10b981;">
                    <h4>‚úÖ Focus on Unusual Activity</h4>
                    <p>Normal options trading is noise. Look for UNUSUAL activity‚ÄîVol/OI >2x, sudden spikes, or concentrated strikes.</p>
                    <div class="highlight">Signal-to-noise filtering</div>
                </div>
                <div class="card" style="border-left: 4px solid #10b981;">
                    <h4>‚úÖ Liquid Names Only</h4>
                    <p>SPY, QQQ, AAPL, MSFT, GOOGL, AMZN, TSLA, META, NVDA‚Äîthese have reliable, institutional-quality options data.</p>
                    <div class="highlight">Quality over quantity</div>
                </div>
                <div class="card" style="border-left: 4px solid #10b981;">
                    <h4>‚úÖ Timing Matters</h4>
                    <p>Options signals work best 1-3 days ahead. Don't expect instant moves‚Äîinstitutions build positions gradually.</p>
                    <div class="highlight">Patience required</div>
                </div>
            </div>
        </section>

        <!-- PART 8: SUMMARY -->
        <section class="content-section fade-in">
            <h2>Part 8: Summary & Cheat Sheet</h2>

            <div class="formula-box">
                <h3>Key Formulas</h3>
                <div class="formula">Intrinsic Value (Call) = max(Stock - Strike, 0)</div>
                <div class="formula">Intrinsic Value (Put) = max(Strike - Stock, 0)</div>
                <div class="formula">Vol/OI Ratio > 2.0 = Unusual Activity</div>
                <div class="formula">P/C Ratio < 0.7 = Bullish | P/C Ratio > 1.3 = Bearish</div>
            </div>

            <h3>Quick Reference Table</h3>
            <table class="options-table">
                <thead>
                    <tr>
                        <th>Signal</th>
                        <th>What You See</th>
                        <th>What It Means</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="signal-bullish">BULLISH</td>
                        <td>Heavy call buying, P/C < 0.7</td>
                        <td>Institutions positioning long</td>
                        <td>Add to bullish watchlist</td>
                    </tr>
                    <tr>
                        <td class="signal-bearish">BEARISH</td>
                        <td>Heavy put buying, P/C > 1.3</td>
                        <td>Institutions hedging/shorting</td>
                        <td>Avoid longs, watch for shorts</td>
                    </tr>
                    <tr>
                        <td class="signal-neutral">UNUSUAL OTM CALLS</td>
                        <td>Vol/OI > 2x on OTM calls</td>
                        <td>Aggressive bullish bet</td>
                        <td>High conviction bullish signal</td>
                    </tr>
                    <tr>
                        <td class="signal-neutral">HIGH IV</td>
                        <td>Expensive premiums</td>
                        <td>Big move expected</td>
                        <td>Prepare for volatility</td>
                    </tr>
                </tbody>
            </table>

            <div class="info-box">
                <div class="info-box-title">Key Takeaways</div>
                <ul style="margin-left: 20px;">
                    <li>Options data shows institutional positioning BEFORE stock moves</li>
                    <li>Use options as intelligence, NOT as trades themselves</li>
                    <li>Focus on unusual activity: Vol/OI > 2x, P/C extremes</li>
                    <li>Combine with technical analysis for best results</li>
                    <li>Stick to liquid stocks/ETFs for reliable signals</li>
                    <li>Expect 1-3 day lead time, not instant moves</li>
                </ul>
            </div>
        </section>

        <!-- INTERACTIVE CALCULATOR -->
        <section class="content-section fade-in">
            <h2>Interactive Options Analyzer</h2>

            <div class="calculator-section">
                <h3>Option Value Calculator</h3>
                <div class="calc-grid">
                    <div>
                        <label>Stock Price ($)</label>
                        <input type="number" id="calcStockPrice" class="calc-input" value="180" step="0.01">
                    </div>
                    <div>
                        <label>Strike Price ($)</label>
                        <input type="number" id="calcStrikePrice" class="calc-input" value="175" step="0.01">
                    </div>
                    <div>
                        <label>Option Premium ($)</label>
                        <input type="number" id="calcPremium" class="calc-input" value="8.50" step="0.01">
                    </div>
                    <div>
                        <label>Option Type</label>
                        <select id="calcOptionType" class="calc-input">
                            <option value="call">Call</option>
                            <option value="put">Put</option>
                        </select>
                    </div>
                </div>
                <button class="calc-btn" onclick="calculateOptionValue()">Analyze Option</button>
                <div id="optionResult" class="calc-result" style="display: none;"></div>
            </div>

            <div class="calculator-section">
                <h3>Put/Call Ratio Signal</h3>
                <div class="calc-grid">
                    <div>
                        <label>Call Volume</label>
                        <input type="number" id="callVolume" class="calc-input" value="45000">
                    </div>
                    <div>
                        <label>Put Volume</label>
                        <input type="number" id="putVolume" class="calc-input" value="15000">
                    </div>
                    <div>
                        <label>Call Open Interest</label>
                        <input type="number" id="callOI" class="calc-input" value="120000">
                    </div>
                    <div>
                        <label>Put Open Interest</label>
                        <input type="number" id="putOI" class="calc-input" value="80000">
                    </div>
                </div>
                <button class="calc-btn" onclick="calculatePCSignal()">Generate Signal</button>
                <div id="pcResult" class="calc-result" style="display: none;"></div>
            </div>
        </section>

        <!-- CHARTS -->
        <section class="content-section fade-in">
            <h2>Visualizations</h2>

            <div class="chart-container">
                <h3>Options Chain Volume Analysis</h3>
                <canvas id="volumeChart"></canvas>
            </div>

            <div class="chart-container">
                <h3>Put/Call Ratio Over Time</h3>
                <canvas id="pcRatioChart"></canvas>
            </div>

            <div class="chart-container">
                <h3>Open Interest by Strike</h3>
                <canvas id="oiChart"></canvas>
            </div>
        </section>

        <!-- QUIZ -->
        <section class="content-section fade-in">
            <h2>Knowledge Check</h2>

            <div class="quiz-container" id="quiz">
                <div class="quiz-question" data-question="1">
                    <h4>Question 1: What does a Vol/OI ratio of 3.5 indicate?</h4>
                    <div class="quiz-options">
                        <div class="quiz-option" data-correct="false">Normal trading activity</div>
                        <div class="quiz-option" data-correct="true">Unusual activity - volume is 3.5x the open interest</div>
                        <div class="quiz-option" data-correct="false">Low liquidity</div>
                        <div class="quiz-option" data-correct="false">Option is about to expire</div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>

                <div class="quiz-question" data-question="2">
                    <h4>Question 2: If AAPL is at $180, what is the intrinsic value of a $170 call?</h4>
                    <div class="quiz-options">
                        <div class="quiz-option" data-correct="false">$0</div>
                        <div class="quiz-option" data-correct="true">$10</div>
                        <div class="quiz-option" data-correct="false">$170</div>
                        <div class="quiz-option" data-correct="false">$180</div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>

                <div class="quiz-question" data-question="3">
                    <h4>Question 3: A Put/Call volume ratio of 0.3 indicates:</h4>
                    <div class="quiz-options">
                        <div class="quiz-option" data-correct="false">Bearish sentiment</div>
                        <div class="quiz-option" data-correct="true">Bullish sentiment - heavy call buying</div>
                        <div class="quiz-option" data-correct="false">Neutral sentiment</div>
                        <div class="quiz-option" data-correct="false">Market is closed</div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>

                <div class="quiz-question" data-question="4">
                    <h4>Question 4: Heavy put buying could indicate:</h4>
                    <div class="quiz-options">
                        <div class="quiz-option" data-correct="false">Only bearish speculation</div>
                        <div class="quiz-option" data-correct="false">Only protective hedging</div>
                        <div class="quiz-option" data-correct="true">Either bearish speculation OR protective hedging - context matters</div>
                        <div class="quiz-option" data-correct="false">Bullish sentiment</div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>

                <div class="quiz-question" data-question="5">
                    <h4>Question 5: As a stock trader, what should you do when you see unusual call activity?</h4>
                    <div class="quiz-options">
                        <div class="quiz-option" data-correct="false">Immediately buy the call options</div>
                        <div class="quiz-option" data-correct="true">Add the stock to your bullish watchlist and look for technical entry</div>
                        <div class="quiz-option" data-correct="false">Short the stock</div>
                        <div class="quiz-option" data-correct="false">Ignore it completely</div>
                    </div>
                    <div class="quiz-feedback"></div>
                </div>
            </div>

            <div class="quiz-score" id="quizScore" style="display: none;">
                <h3>Quiz Complete!</h3>
                <p>Your score: <span id="scoreValue"></span>/5</p>
            </div>
        </section>

        <!-- Navigation -->
        <div class="module-navigation">
            <a href="../../../index.html" class="nav-btn">‚Üê Back to Course</a>
            <a href="8.1.2_implied_volatility_fear_gauge.html" class="nav-btn">Next: Implied Volatility ‚Üí</a>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

    <script>
        // Copy code functionality
        function copyCode(button) {
            const codeBlock = button.parentElement.nextElementSibling.querySelector('code');
            navigator.clipboard.writeText(codeBlock.textContent);
            button.textContent = 'Copied!';
            setTimeout(() => button.textContent = 'Copy', 2000);
        }

        // Option Value Calculator
        function calculateOptionValue() {
            const stockPrice = parseFloat(document.getElementById('calcStockPrice').value);
            const strikePrice = parseFloat(document.getElementById('calcStrikePrice').value);
            const premium = parseFloat(document.getElementById('calcPremium').value);
            const optionType = document.getElementById('calcOptionType').value;

            let intrinsicValue, moneyness;

            if (optionType === 'call') {
                intrinsicValue = Math.max(stockPrice - strikePrice, 0);
            } else {
                intrinsicValue = Math.max(strikePrice - stockPrice, 0);
            }

            const extrinsicValue = Math.max(premium - intrinsicValue, 0);

            // Determine moneyness
            const pctDiff = Math.abs(stockPrice - strikePrice) / stockPrice;
            if (pctDiff <= 0.02) {
                moneyness = 'ATM (At The Money)';
            } else if (optionType === 'call') {
                moneyness = stockPrice > strikePrice ? 'ITM (In The Money)' : 'OTM (Out of The Money)';
            } else {
                moneyness = stockPrice < strikePrice ? 'ITM (In The Money)' : 'OTM (Out of The Money)';
            }

            const resultDiv = document.getElementById('optionResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <h4 style="color: #6366f1;">Option Analysis</h4>
                <p><strong>Option Type:</strong> ${optionType.toUpperCase()}</p>
                <p><strong>Moneyness:</strong> <span class="${moneyness.includes('ITM') ? 'moneyness-itm' : moneyness.includes('OTM') ? 'moneyness-otm' : 'moneyness-atm'}">${moneyness}</span></p>
                <p><strong>Intrinsic Value:</strong> $${intrinsicValue.toFixed(2)}</p>
                <p><strong>Extrinsic (Time) Value:</strong> $${extrinsicValue.toFixed(2)}</p>
                <p><strong>Total Premium:</strong> $${premium.toFixed(2)}</p>
                <p style="margin-top: 10px; color: #94a3b8;"><em>${extrinsicValue > intrinsicValue ? 'High time value suggests market expects significant move' : 'Premium mostly intrinsic value'}</em></p>
            `;
        }

        // P/C Ratio Signal Calculator
        function calculatePCSignal() {
            const callVol = parseInt(document.getElementById('callVolume').value);
            const putVol = parseInt(document.getElementById('putVolume').value);
            const callOI = parseInt(document.getElementById('callOI').value);
            const putOI = parseInt(document.getElementById('putOI').value);

            const volPCRatio = putVol / callVol;
            const oiPCRatio = putOI / callOI;

            let signal, strength, color;

            if (volPCRatio < 0.5) {
                signal = 'BULLISH';
                strength = 'STRONG';
                color = '#10b981';
            } else if (volPCRatio < 0.7) {
                signal = 'BULLISH';
                strength = 'MODERATE';
                color = '#10b981';
            } else if (volPCRatio > 1.5) {
                signal = 'BEARISH/HEDGING';
                strength = 'STRONG';
                color = '#ef4444';
            } else if (volPCRatio > 1.0) {
                signal = 'BEARISH/HEDGING';
                strength = 'MODERATE';
                color = '#ef4444';
            } else {
                signal = 'NEUTRAL';
                strength = 'WEAK';
                color = '#f59e0b';
            }

            const resultDiv = document.getElementById('pcResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <h4 style="color: ${color};">Signal: ${signal} (${strength})</h4>
                <p><strong>Volume P/C Ratio:</strong> ${volPCRatio.toFixed(2)}</p>
                <p><strong>Open Interest P/C Ratio:</strong> ${oiPCRatio.toFixed(2)}</p>
                <p><strong>Interpretation:</strong> ${
                    signal === 'BULLISH' ? 'Heavy call buying indicates institutional bullish positioning. Consider adding to long watchlist.' :
                    signal.includes('BEARISH') ? 'Heavy put activity detected. Could be bearish speculation or protective hedging - investigate context.' :
                    'Mixed signals. No clear directional bias from options flow.'
                }</p>
            `;
        }

        // Charts
        document.addEventListener('DOMContentLoaded', function() {
            // Volume Chart
            const volumeCtx = document.getElementById('volumeChart').getContext('2d');
            new Chart(volumeCtx, {
                type: 'bar',
                data: {
                    labels: ['$170', '$175', '$180', '$185', '$190', '$195'],
                    datasets: [
                        {
                            label: 'Call Volume',
                            data: [5000, 8000, 12000, 6000, 25000, 3000],
                            backgroundColor: 'rgba(16, 185, 129, 0.7)',
                            borderColor: '#10b981',
                            borderWidth: 1
                        },
                        {
                            label: 'Put Volume',
                            data: [2000, 5000, 3000, 4000, 1000, 500],
                            backgroundColor: 'rgba(239, 68, 68, 0.7)',
                            borderColor: '#ef4444',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { labels: { color: '#94a3b8' } },
                        title: { display: true, text: 'AAPL Options Volume by Strike', color: '#f1f5f9' }
                    },
                    scales: {
                        y: {
                            ticks: { color: '#94a3b8' },
                            grid: { color: 'rgba(148, 163, 184, 0.1)' },
                            title: { display: true, text: 'Volume', color: '#94a3b8' }
                        },
                        x: {
                            ticks: { color: '#94a3b8' },
                            grid: { color: 'rgba(148, 163, 184, 0.1)' },
                            title: { display: true, text: 'Strike Price', color: '#94a3b8' }
                        }
                    }
                }
            });

            // P/C Ratio Chart
            const pcCtx = document.getElementById('pcRatioChart').getContext('2d');
            new Chart(pcCtx, {
                type: 'line',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri'],
                    datasets: [{
                        label: 'Put/Call Ratio',
                        data: [0.85, 0.72, 0.65, 0.58, 0.45, 0.42, 0.38, 0.33, 0.35, 0.33],
                        borderColor: '#6366f1',
                        backgroundColor: 'rgba(99, 102, 241, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { labels: { color: '#94a3b8' } },
                        title: { display: true, text: 'AAPL Put/Call Ratio Trend (Bullish = Declining)', color: '#f1f5f9' },
                        annotation: {
                            annotations: {
                                line1: {
                                    type: 'line',
                                    yMin: 0.7,
                                    yMax: 0.7,
                                    borderColor: '#10b981',
                                    borderWidth: 2,
                                    borderDash: [5, 5],
                                    label: { content: 'Bullish Threshold', enabled: true }
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            ticks: { color: '#94a3b8' },
                            grid: { color: 'rgba(148, 163, 184, 0.1)' },
                            title: { display: true, text: 'P/C Ratio', color: '#94a3b8' }
                        },
                        x: {
                            ticks: { color: '#94a3b8' },
                            grid: { color: 'rgba(148, 163, 184, 0.1)' }
                        }
                    }
                }
            });

            // Open Interest Chart
            const oiCtx = document.getElementById('oiChart').getContext('2d');
            new Chart(oiCtx, {
                type: 'bar',
                data: {
                    labels: ['$165', '$170', '$175', '$180', '$185', '$190', '$195'],
                    datasets: [
                        {
                            label: 'Call OI',
                            data: [5000, 10000, 15000, 20000, 8000, 8000, 5000],
                            backgroundColor: 'rgba(16, 185, 129, 0.5)',
                            borderColor: '#10b981',
                            borderWidth: 1
                        },
                        {
                            label: 'Put OI',
                            data: [10000, 25000, 15000, 12000, 5000, 2000, 1000],
                            backgroundColor: 'rgba(239, 68, 68, 0.5)',
                            borderColor: '#ef4444',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { labels: { color: '#94a3b8' } },
                        title: { display: true, text: 'Open Interest Distribution (Support/Resistance Levels)', color: '#f1f5f9' }
                    },
                    scales: {
                        y: {
                            ticks: { color: '#94a3b8' },
                            grid: { color: 'rgba(148, 163, 184, 0.1)' },
                            title: { display: true, text: 'Open Interest', color: '#94a3b8' }
                        },
                        x: {
                            ticks: { color: '#94a3b8' },
                            grid: { color: 'rgba(148, 163, 184, 0.1)' },
                            title: { display: true, text: 'Strike Price', color: '#94a3b8' }
                        }
                    }
                }
            });
        });

        // Quiz functionality
        document.querySelectorAll('.quiz-option').forEach(option => {
            option.addEventListener('click', function() {
                const question = this.closest('.quiz-question');
                const options = question.querySelectorAll('.quiz-option');
                const feedback = question.querySelector('.quiz-feedback');

                if (question.classList.contains('answered')) return;

                question.classList.add('answered');
                options.forEach(opt => opt.style.pointerEvents = 'none');

                const isCorrect = this.dataset.correct === 'true';
                this.classList.add(isCorrect ? 'correct' : 'incorrect');

                if (!isCorrect) {
                    options.forEach(opt => {
                        if (opt.dataset.correct === 'true') opt.classList.add('correct');
                    });
                }

                feedback.textContent = isCorrect ? 'Correct!' : 'Incorrect. See the correct answer above.';
                feedback.style.color = isCorrect ? '#10b981' : '#ef4444';
                feedback.style.display = 'block';

                checkQuizComplete();
            });
        });

        function checkQuizComplete() {
            const questions = document.querySelectorAll('.quiz-question');
            const answered = document.querySelectorAll('.quiz-question.answered');

            if (questions.length === answered.length) {
                const correct = document.querySelectorAll('.quiz-option.correct:not(.incorrect)').length;
                document.getElementById('scoreValue').textContent = correct;
                document.getElementById('quizScore').style.display = 'block';
            }
        }

        // Scroll animations
        const observerOptions = { threshold: 0.1, rootMargin: '0px 0px -50px 0px' };
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                }
            });
        }, observerOptions);

        document.querySelectorAll('.fade-in').forEach(el => observer.observe(el));
    </script>
</body>
</html>
