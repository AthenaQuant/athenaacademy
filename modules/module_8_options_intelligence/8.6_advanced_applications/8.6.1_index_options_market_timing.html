<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Master index options for market timing. Learn SPY/QQQ intelligence, GEX analysis, VIX signals, and mega-cap confirmation to control overall market exposure.">
    <title>8.6.1 Index Options for Market Timing | Quantitative Trading Mastery</title>
    <link rel="stylesheet" href="../../../assets/css/shared-styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <link rel="icon" href="../../../assets/images/logo.png" type="image/png">
    <style>
        .market-signal-eq { font-size: 1.3rem; color: #a855f7; text-align: center; padding: 18px; background: rgba(168, 85, 247, 0.1); border-radius: 10px; margin: 18px 0; border: 1px solid rgba(168, 85, 247, 0.3); }
        .signal-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin: 18px 0; }
        @media (max-width: 768px) { .signal-grid { grid-template-columns: repeat(2, 1fr); } }
        .signal-card { background: rgba(0,0,0,0.2); border-radius: 8px; padding: 12px; text-align: center; border: 1px solid rgba(148, 163, 184, 0.1); }
        .signal-value { font-size: 1.3rem; font-weight: bold; color: #a855f7; }
        .signal-label { font-size: 0.8rem; color: #94a3b8; margin-top: 4px; }
        .regime-table { width: 100%; border-collapse: collapse; margin: 18px 0; font-size: 0.88rem; }
        .regime-table th, .regime-table td { padding: 10px; border: 1px solid rgba(148, 163, 184, 0.2); text-align: center; }
        .regime-table th { background: rgba(168, 85, 247, 0.2); color: #d8b4fe; }
        .regime-table tr:hover { background: rgba(168, 85, 247, 0.1); }
        .calculator-box { background: rgba(0,0,0,0.3); border-radius: 14px; padding: 22px; margin: 22px 0; border: 1px solid rgba(168, 85, 247, 0.3); }
        .calc-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin: 12px 0; }
        @media (max-width: 768px) { .calc-grid { grid-template-columns: 1fr; } }
        .calc-input { background: rgba(0,0,0,0.3); border: 1px solid rgba(148, 163, 184, 0.3); border-radius: 6px; padding: 10px; color: #f1f5f9; width: 100%; }
        .calc-input:focus { outline: none; border-color: #a855f7; }
        .calc-btn { background: linear-gradient(135deg, #a855f7, #9333ea); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 600; transition: transform 0.2s, box-shadow 0.2s; }
        .calc-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 18px rgba(168, 85, 247, 0.4); }
        .calc-result { background: rgba(168, 85, 247, 0.1); border: 1px solid rgba(168, 85, 247, 0.3); border-radius: 6px; padding: 12px; margin-top: 12px; }
        .chart-container { position: relative; height: 350px; margin: 20px 0; }
        .chart-container canvas { max-height: 320px; }
        .quiz-section { background: rgba(0,0,0,0.2); border-radius: 12px; padding: 25px; margin: 30px 0; border: 1px solid rgba(148,163,184,0.2); }
        .quiz-question { margin: 25px 0; padding: 20px; background: rgba(0,0,0,0.15); border-radius: 10px; }
        .quiz-options { margin: 15px 0; }
        .quiz-options button { display: block; width: 100%; text-align: left; padding: 12px 16px; margin: 8px 0; background: rgba(0,0,0,0.3); border: 2px solid rgba(148,163,184,0.3); border-radius: 8px; color: #f1f5f9; cursor: pointer; transition: all 0.2s; font-size: 0.95rem; }
        .quiz-options button:hover { border-color: #a855f7; background: rgba(168,85,247,0.1); transform: translateX(4px); }
        .quiz-explanation { margin-top: 12px; padding: 12px; background: rgba(34,211,238,0.1); border-left: 3px solid #22d3ee; border-radius: 6px; font-size: 0.9rem; color: #cbd5e1; }
    </style>
</head>
<body>
    <nav class="module-nav-header"><div class="container"><div class="nav-content">
        <a href="../../../index.html" class="nav-home">&larr; Back to Course</a>
        <div class="nav-module-info"><span class="nav-module-number">Module 8.6.1</span><span class="nav-module-title">Index Options Market Timing</span></div>
        <a href="../../../index.html" class="nav-next">Course Home &rarr;</a>
    </div></div></nav>

    <header class="module-hero"><div class="container"><div class="module-hero-content">
        <div class="module-breadcrumb"><span>Module 8: Options Market Intelligence</span><span class="breadcrumb-separator">&rsaquo;</span><span>8.6 Advanced Applications</span><span class="breadcrumb-separator">&rsaquo;</span><span>8.6.1 Market Timing</span></div>
        <h1>Index Options for Market Timing</h1>
        <p class="module-subtitle">SPY/QQQ options intelligence controls your overall market exposure. Learn GEX analysis, VIX signals, mega-cap confirmation, and 0DTE flow to time the market like institutions.</p>
        <div class="module-meta"><span class="meta-item">‚è±Ô∏è 60 min read</span><span class="meta-item">üìä 3 Visualizations</span><span class="meta-item">üíª Market Signal System</span><span class="meta-item">‚úÖ 5 Quiz Questions</span></div>
    </div></div></header>

    <main class="container content-wrapper">
        <!-- Part 1: Why Should I Care? -->
        <section class="content-section fade-in">
            <h2>Part 1: Why Should I Care?</h2>
            <div class="info-box info-box-warning"><div class="info-box-title">September 2021: Missing the Market Signal</div>
            <p>SPY at $453 (all-time high). Your portfolio: 100% long. Unknown to you, institutions aggressively bought SPY puts for 48 hours straight. Put/call ratio: 1.52 (extreme). SPY put premium: $200M in one session. GEX flipped negative. All signals screamed "DANGER." You ignored them. Result: Market corrected 6% over 3 weeks. Your portfolio: -9.2%. <strong>Those who reduced exposure to 30% based on index signals lost only -2.8%</strong>. The $6,400 difference on a $100K account could have been saved by watching index options.</p></div>

            <div class="market-signal-eq">Index Signal = f(SPY P/C, GEX, VIX, Mega-Caps, 0DTE) &nbsp;‚Üí&nbsp; Exposure Control</div>

            <div class="card-grid">
                <div class="card"><h4>When to Be in the Market</h4><p>Index options tell you when it's safe to be fully invested vs. when to go defensive. This is the most important trading decision you'll make.</p></div>
                <div class="card"><h4>SPY GEX = Market Stability</h4><p>Gamma exposure predicts volatility. Positive GEX = stable market. Negative GEX = dealers amplify moves. Feb 2018 Volmageddon: GEX went negative 4 days before -11% crash.</p></div>
                <div class="card"><h4>Institutional Positioning</h4><p>Institutions hedge with index options before major moves. Heavy SPY put buying = smart money getting defensive. Follow their lead.</p></div>
                <div class="card"><h4>Mega-Cap Confirmation</h4><p>AAPL, MSFT, NVDA are 40% of SPY. Their options flow confirms or contradicts index signals.</p></div>
            </div>

            <div class="signal-grid">
                <div class="signal-card"><div class="signal-value">3-7 days</div><div class="signal-label">Warning Lead Time</div></div>
                <div class="signal-card"><div class="signal-value">85-90%</div><div class="signal-label">Negative GEX Accuracy</div></div>
                <div class="signal-card"><div class="signal-value">30-100%</div><div class="signal-label">Recommended Exposure Range</div></div>
                <div class="signal-card"><div class="signal-value">78-82%</div><div class="signal-label">Multi-Signal Win Rate</div></div>
            </div>
        </section>

        <!-- Part 2: Building Intuition -->
        <section class="content-section fade-in">
            <h2>Part 2: Building Intuition</h2>
            <h3>Understanding Index Options Intelligence</h3>
            <p>Index options (SPY, QQQ, SPX, NDX) provide market-level intelligence. Unlike individual stock options, index options reveal what institutions think about the <strong>overall market direction</strong>.</p>

            <div class="info-box"><div class="info-box-title">Why Institutions Use Index Options</div>
            <p>Portfolio managers don't sell stocks when they get nervous (tax implications, market impact). Instead, they buy SPY/SPX puts as insurance. This telegraphs their fear BEFORE the market crashes. When hundreds of institutions make this decision simultaneously, it creates massive put buying that retail traders can detect.</p></div>

            <h3>The Four Index Signals</h3>
            <table class="regime-table">
                <thead><tr><th>Signal</th><th>Normal</th><th>Warning</th><th>Danger</th><th>What It Means</th></tr></thead>
                <tbody>
                    <tr><td><strong>SPY Put/Call</strong></td><td>0.9-1.1</td><td>1.2-1.5</td><td>&gt;1.5</td><td>Defensive positioning</td></tr>
                    <tr><td><strong>SPY GEX</strong></td><td>$2-5B</td><td>$0-2B</td><td>&lt;$0 (neg!)</td><td>Market stability</td></tr>
                    <tr><td><strong>VIX</strong></td><td>15-25</td><td>25-35</td><td>&gt;35 or &lt;12</td><td>Fear level</td></tr>
                    <tr><td><strong>Mega-Caps</strong></td><td>Mixed</td><td>2+ bearish</td><td>All bearish</td><td>Confirmation</td></tr>
                </tbody>
            </table>

            <h3>SPY GEX: The Most Critical Signal</h3>
            <p>Gamma exposure (GEX) tells you if dealers will stabilize or amplify market moves.</p>
            <div class="market-signal-eq">Net GEX = Œ£ (Dealer Gamma √ó OI √ó 100 √ó Price¬≤ √ó 0.01) &nbsp;|&nbsp; Calls = +Gamma, Puts = -Gamma</div>
            <ul>
                <li><strong>GEX &gt; $3B:</strong> Very stable market. Dealers buy dips, sell rallies (stabilizing).</li>
                <li><strong>GEX $0-2B:</strong> Neutral. Normal vol.</li>
                <li><strong>GEX &lt; $0 (NEGATIVE):</strong> DANGER! Dealers amplify moves. Sell into declines, buy into rallies. This causes flash crashes.</li>
            </ul>

            <div class="info-box info-box-warning"><div class="info-box-title">Historical Lesson: February 2018 Volmageddon</div>
            <p><strong>Feb 1, 2018:</strong> SPY GEX flipped from +$4B to -$1.2B (negative!). <strong>Feb 5, 2018:</strong> SPY crashed -5.5% in one day. VIX exploded from 17 to 50. Negative GEX gave 4 days warning. Those who went defensive saved 8-11%.</p></div>
        </section>

        <!-- Part 3: The Mathematics -->
        <section class="content-section fade-in">
            <h2>Part 3: The Mathematics</h2>
            <h3>1. SPY Put/Call Ratio</h3>
            <div class="market-signal-eq">SPY P/C = SPY Put Volume / SPY Call Volume</div>
            <p>Interpretation: &gt;1.2 = defensive, 0.8-1.2 = normal, &lt;0.8 = bullish</p>
            <p><strong>Critical insight:</strong> Use 5-day moving average to detect sudden changes.</p>
            <div class="market-signal-eq">Regime Change = |Current P/C - 5-Day Avg| &gt; 0.3</div>

            <h3>2. Expected Market Move from VIX</h3>
            <div class="market-signal-eq">Weekly Move = SPY √ó (VIX / 100) √ó ‚àö(5 / 252)</div>
            <div class="market-signal-eq">Daily Move = SPY √ó (VIX / 100) √ó ‚àö(1 / 252)</div>
            <p><strong>Example:</strong> SPY $450, VIX 18 ‚Üí Weekly move = $450 √ó 0.18 √ó 0.141 = ¬±$11.41 (2.5%)</p>

            <h3>3. Market Signal Scoring System</h3>
            <div class="market-signal-eq">
                Bullish Score = Œ£ (Signal Weights √ó Signal Values)<br>
                Bearish Score = Œ£ (Signal Weights √ó Signal Values)
            </div>
            <p>Weights: SPY P/C (30%), GEX (30%), VIX (20%), Mega-Caps (15%), 0DTE (5%)</p>

            <table class="regime-table">
                <thead><tr><th>Signal Input</th><th>Bullish Points</th><th>Bearish Points</th></tr></thead>
                <tbody>
                    <tr><td>SPY P/C &lt; 0.8</td><td>+2</td><td>0</td></tr>
                    <tr><td>SPY P/C &gt; 1.2</td><td>0</td><td>+2</td></tr>
                    <tr><td>GEX &gt; $3B</td><td>+1</td><td>0</td></tr>
                    <tr><td>GEX &lt; $0</td><td>0</td><td>+3</td></tr>
                    <tr><td>VIX &lt; 15</td><td>+1</td><td>0</td></tr>
                    <tr><td>VIX &gt; 35</td><td>+2 (contrarian)</td><td>0</td></tr>
                    <tr><td>All mega-caps bullish</td><td>+2</td><td>0</td></tr>
                    <tr><td>All mega-caps bearish</td><td>0</td><td>+2</td></tr>
                </tbody>
            </table>
        </section>

        <!-- Part 4: Numerical Example -->
        <section class="content-section fade-in">
            <h2>Part 4: Numerical Example</h2>
            <h3>Complete Market Timing Analysis</h3>
            <div class="info-box"><div class="info-box-title">Scenario: Thursday, October 5, 2023, 2:00 PM ET</div>
            <p><strong>Market conditions:</strong> SPY $452.30, VIX 16.5 (low), Market at 2-month highs</p></div>

            <h4>Step 1: SPY Put/Call Analysis</h4>
            <table class="regime-table">
                <thead><tr><th>Metric</th><th>Value</th><th>Interpretation</th></tr></thead>
                <tbody>
                    <tr><td>Call Volume</td><td>920,000</td><td>‚Äî</td></tr>
                    <tr><td>Put Volume</td><td>1,334,000</td><td>‚Äî</td></tr>
                    <tr><td><strong>Current P/C</strong></td><td><strong>1.45</strong></td><td>‚ö†Ô∏è Defensive surge</td></tr>
                    <tr><td>5-day avg P/C</td><td>0.95</td><td>‚Äî</td></tr>
                    <tr><td>Change</td><td>+0.50</td><td>üö® Major regime change!</td></tr>
                </tbody>
            </table>

            <h4>Step 2: Unusual SPY Activity</h4>
            <p><strong>SPY $445 Puts (7 DTE):</strong></p>
            <ul>
                <li>Volume: 150,000 contracts (5x normal!)</li>
                <li>Price: $5.70</li>
                <li>Premium: $85.5 million</li>
                <li>Execution: Aggressive at ask (institutional)</li>
            </ul>

            <h4>Step 3: SPY GEX Calculation</h4>
            <table class="regime-table">
                <thead><tr><th>Metric</th><th>Current</th><th>3 Days Ago</th><th>Status</th></tr></thead>
                <tbody>
                    <tr><td>Net GEX</td><td>-$1.2B</td><td>+$2.5B</td><td>‚ö†Ô∏è NEGATIVE!</td></tr>
                    <tr><td>Zero Gamma</td><td>$448.00</td><td>$445.00</td><td>Danger zone</td></tr>
                    <tr><td>Current SPY</td><td>$452.30</td><td>‚Äî</td><td>Above zero gamma</td></tr>
                </tbody>
            </table>
            <p class="info-box info-box-warning">‚ö†Ô∏è‚ö†Ô∏è Negative GEX means dealers will amplify downward moves. If SPY drops below $448, expect acceleration.</p>

            <h4>Step 4: Mega-Cap Confirmation</h4>
            <table class="regime-table">
                <thead><tr><th>Stock</th><th>P/C Ratio</th><th>Signal</th><th>Details</th></tr></thead>
                <tbody>
                    <tr><td>AAPL</td><td>1.40</td><td>‚ö†Ô∏è Bearish</td><td>Unusual $170 put buying</td></tr>
                    <tr><td>MSFT</td><td>1.35</td><td>‚ö†Ô∏è Bearish</td><td>Large put spreads</td></tr>
                    <tr><td>NVDA</td><td>1.60</td><td>‚ö†Ô∏è Bearish</td><td>Aggressive put buying</td></tr>
                    <tr><td>GOOGL</td><td>1.25</td><td>‚ö†Ô∏è Bearish</td><td>Unusual activity</td></tr>
                </tbody>
            </table>
            <p><strong>‚úÖ Confirmation:</strong> All four mega-caps showing defensive positioning.</p>

            <h4>Step 5: Combined Signal</h4>
            <div class="market-signal-eq">
                <strong>Scoring:</strong><br>
                SPY P/C (1.45 &gt; 1.2): Bearish +2<br>
                Sudden P/C surge (+0.50): Bearish +2<br>
                SPY GEX (-$1.2B &lt; 0): Bearish +3<br>
                Mega-caps (all bearish): Bearish +2<br>
                <strong>Total: 9/10 Bearish</strong>
            </div>

            <div class="info-box info-box-warning"><div class="info-box-title">üö® MARKET SIGNAL: STRONG BEARISH</div>
            <ul>
                <li><strong>Confidence:</strong> VERY HIGH</li>
                <li><strong>Recommended Exposure:</strong> 30% (reduce from 100%)</li>
                <li><strong>Action:</strong> Take profits, go to 70% cash, tighten stops</li>
            </ul></div>

            <h4>Actual Result</h4>
            <p><strong>Over next 5 days:</strong> SPY fell from $452.30 to $436.70 (-3.5%)</p>
            <ul>
                <li><strong>Ignored signal (100% invested):</strong> Lost -5.2%</li>
                <li><strong>Followed signal (30% invested):</strong> Lost -1.6%</li>
                <li><strong>Saved: 3.6%</strong> ($3,600 on $100K account)</li>
            </ul>
        </section>

        <!-- Part 5: Python Implementation -->
        <section class="content-section fade-in">
            <h2>Part 5: Python Implementation</h2>
            <div class="code-block">
                <div class="code-header">
                    <span>index_options_intelligence.py</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre><code class="language-python">"""
Index Options Market Timing Intelligence
SPY/QQQ intelligence for controlling overall market exposure.
"""

import pandas as pd
import numpy as np
from typing import Dict, Tuple
from dataclasses import dataclass
from enum import Enum
from datetime import datetime

class MarketSignal(Enum):
    STRONG_BULLISH = "Strong Bullish"
    BULLISH = "Bullish"
    NEUTRAL = "Neutral"
    BEARISH = "Bearish"
    STRONG_BEARISH = "Strong Bearish"

@dataclass
class IndexOptionsIntelligence:
    """Complete index options analysis."""
    timestamp: datetime
    spy_price: float
    spy_put_call_ratio: float
    spy_put_call_5day_avg: float
    spy_gex: float
    spy_zero_gamma: float
    vix_level: float
    vix_regime: str
    mega_cap_signal: str
    market_signal: MarketSignal
    confidence: str
    recommended_exposure: float

def calculate_spy_gex(spy_options: pd.DataFrame, spy_price: float) -> Dict:
    """Calculate SPY gamma exposure and zero gamma level."""
    dealer_multiplier = -1
    total_gex = 0
    gex_by_strike = {}

    for _, row in spy_options.iterrows():
        strike = row['strike']
        gamma_notional = (row['open_interest'] * 100 * row['gamma'] *
                         spy_price * spy_price * 0.01 * dealer_multiplier)

        if row['type'] == 'call':
            contribution = gamma_notional
        else:
            contribution = -gamma_notional

        total_gex += contribution
        if strike not in gex_by_strike:
            gex_by_strike[strike] = 0
        gex_by_strike[strike] += contribution

    # Find zero gamma level
    strikes_sorted = sorted(gex_by_strike.keys())
    cumulative_gex = 0
    zero_gamma_strike = spy_price

    for strike in strikes_sorted:
        cumulative_gex += gex_by_strike[strike]
        if cumulative_gex >= 0 and strike <= spy_price:
            zero_gamma_strike = strike
        elif cumulative_gex < 0:
            break

    return {
        'net_gex_billions': total_gex / 1e9,
        'zero_gamma_level': zero_gamma_strike,
        'regime': 'POSITIVE' if total_gex > 0 else 'NEGATIVE'
    }

def generate_market_signal(
    spy_pc: float, spy_pc_5day: float, spy_gex: float,
    vix: float, mega_cap_signal: str
) -> Tuple[MarketSignal, str, float]:
    """Generate market signal and recommended exposure."""
    bullish_score = 0
    bearish_score = 0

    # SPY P/C analysis
    if spy_pc < 0.8:
        bullish_score += 2
    elif spy_pc > 1.2:
        bearish_score += 2

    if spy_pc > spy_pc_5day * 1.3:
        bearish_score += 2
    elif spy_pc < spy_pc_5day * 0.7:
        bullish_score += 2

    # GEX analysis
    if spy_gex > 3:
        bullish_score += 1
    elif spy_gex < 0:
        bearish_score += 3

    # VIX analysis
    if vix < 15:
        bullish_score += 1
    elif vix > 25:
        bearish_score += 2

    if vix > 35:
        bullish_score += 2
        bearish_score -= 2

    # Mega-cap confirmation
    if mega_cap_signal == "BULLISH":
        bullish_score += 2
    elif mega_cap_signal == "BEARISH":
        bearish_score += 2

    # Determine signal and exposure
    if bullish_score >= 6:
        return MarketSignal.STRONG_BULLISH, "HIGH", 1.0
    elif bullish_score >= 4:
        return MarketSignal.BULLISH, "MODERATE", 0.85
    elif bearish_score >= 6:
        return MarketSignal.STRONG_BEARISH, "HIGH", 0.3
    elif bearish_score >= 4:
        return MarketSignal.BEARISH, "MODERATE", 0.5
    else:
        return MarketSignal.NEUTRAL, "LOW", 0.7

def analyze_index_options(
    spy_options: pd.DataFrame, spy_price: float,
    vix_level: float, mega_cap_flows: Dict
) -> IndexOptionsIntelligence:
    """Complete index options analysis."""
    # SPY P/C
    calls = spy_options[spy_options['type'] == 'call']
    puts = spy_options[spy_options['type'] == 'put']
    spy_pc = puts['volume'].sum() / calls['volume'].sum()
    spy_pc_5day = 0.95  # Would fetch from database

    # SPY GEX
    gex_metrics = calculate_spy_gex(spy_options, spy_price)

    # VIX Regime
    if vix_level < 15:
        vix_regime = "LOW (Complacent)"
    elif vix_level < 25:
        vix_regime = "NORMAL"
    elif vix_level < 35:
        vix_regime = "ELEVATED"
    else:
        vix_regime = "PANIC"

    # Mega-cap signal
    bearish_count = sum(1 for v in mega_cap_flows.values()
                       if v.get('put_call_ratio', 1.0) > 1.3)
    mega_cap_signal = "BEARISH" if bearish_count >= 3 else "MIXED"

    # Generate signal
    signal, confidence, exposure = generate_market_signal(
        spy_pc, spy_pc_5day, gex_metrics['net_gex_billions'],
        vix_level, mega_cap_signal
    )

    return IndexOptionsIntelligence(
        timestamp=datetime.now(),
        spy_price=spy_price,
        spy_put_call_ratio=spy_pc,
        spy_put_call_5day_avg=spy_pc_5day,
        spy_gex=gex_metrics['net_gex_billions'],
        spy_zero_gamma=gex_metrics['zero_gamma_level'],
        vix_level=vix_level,
        vix_regime=vix_regime,
        mega_cap_signal=mega_cap_signal,
        market_signal=signal,
        confidence=confidence,
        recommended_exposure=exposure
    )

# Example usage
if __name__ == "__main__":
    spy_options = pd.DataFrame({
        'strike': [440, 445, 450, 455, 460] * 2,
        'type': ['call'] * 5 + ['put'] * 5,
        'volume': [50000, 75000, 100000, 60000, 30000,
                  80000, 120000, 150000, 90000, 40000],
        'open_interest': [100000, 150000, 200000, 120000, 60000,
                         120000, 180000, 250000, 140000, 70000],
        'gamma': [0.03, 0.04, 0.05, 0.04, 0.02] * 2
    })

    mega_caps = {
        'AAPL': {'put_call_ratio': 1.4},
        'MSFT': {'put_call_ratio': 1.3},
        'NVDA': {'put_call_ratio': 1.6},
        'GOOGL': {'put_call_ratio': 1.2},
    }

    result = analyze_index_options(spy_options, 452.30, 16.5, mega_caps)

    print(f"Market Signal: {result.market_signal.value}")
    print(f"Recommended Exposure: {result.recommended_exposure*100:.0f}%")</code></pre>
            </div>
        </section>

        <!-- Part 6: Trading Applications -->
        <section class="content-section fade-in">
            <h2>Part 6: Trading Applications</h2>

            <h3>Daily Trading Workflow</h3>
            <div class="info-box"><div class="info-box-title">Morning Pre-Market (8:30-9:15 AM)</div>
            <ol>
                <li>Check SPY put/call ratio vs. 5-day average</li>
                <li>Review SPY GEX (positive or negative?)</li>
                <li>Check VIX level and regime</li>
                <li>Scan mega-cap options (AAPL, MSFT, NVDA, GOOGL)</li>
                <li>Generate market signal and set exposure for the day</li>
            </ol></div>

            <h3>Position Sizing by Market Signal</h3>
            <table class="regime-table">
                <thead><tr><th>Signal</th><th>Exposure</th><th>Position Size</th><th>Style</th></tr></thead>
                <tbody>
                    <tr><td>Strong Bullish</td><td>90-100%</td><td>3-5% per trade</td><td>Aggressive</td></tr>
                    <tr><td>Bullish</td><td>80-90%</td><td>2-3% per trade</td><td>Normal</td></tr>
                    <tr><td>Neutral</td><td>60-70%</td><td>1-2% per trade</td><td>Selective</td></tr>
                    <tr><td>Bearish</td><td>40-50%</td><td>1% per trade</td><td>Very selective</td></tr>
                    <tr><td>Strong Bearish</td><td>20-30%</td><td>0.5-1% per trade</td><td>Defensive</td></tr>
                </tbody>
            </table>

            <!-- Charts -->
            <h3>SPY Put/Call Ratio History</h3>
            <div class="chart-container"><canvas id="pcRatioChart"></canvas></div>

            <h3>SPY GEX vs Price</h3>
            <div class="chart-container"><canvas id="gexChart"></canvas></div>

            <h3>Recommended Exposure by Signal</h3>
            <div class="chart-container"><canvas id="exposureChart"></canvas></div>

            <!-- Calculator -->
            <div class="calculator-box">
                <h3>Market Signal Calculator</h3>
                <div class="calc-grid">
                    <div><label style="color:#94a3b8;font-size:0.85rem;">SPY Put/Call Ratio</label><input type="number" id="spyPC" class="calc-input" value="1.45" step="0.01"></div>
                    <div><label style="color:#94a3b8;font-size:0.85rem;">SPY 5-Day Avg P/C</label><input type="number" id="spyPC5day" class="calc-input" value="0.95" step="0.01"></div>
                    <div><label style="color:#94a3b8;font-size:0.85rem;">SPY GEX ($B)</label><input type="number" id="spyGEX" class="calc-input" value="-1.2" step="0.1"></div>
                    <div><label style="color:#94a3b8;font-size:0.85rem;">VIX Level</label><input type="number" id="vixLevel" class="calc-input" value="16.5" step="0.1"></div>
                    <div><label style="color:#94a3b8;font-size:0.85rem;">Mega-Cap Signal</label>
                        <select id="megaCapSignal" class="calc-input">
                            <option value="BULLISH">Bullish</option>
                            <option value="MIXED">Mixed</option>
                            <option value="BEARISH" selected>Bearish</option>
                        </select>
                    </div>
                </div>
                <button class="calc-btn" onclick="calculateMarketSignal()">Calculate Signal</button>
                <div class="calc-result" id="marketResult" style="display:none;"></div>
            </div>
        </section>

        <!-- Part 7: Common Mistakes -->
        <section class="content-section fade-in">
            <h2>Part 7: Common Mistakes</h2>
            <div class="card-grid">
                <div class="card"><h4>Mistake 1: Ignoring Index Signals</h4><p><strong>Wrong:</strong> "I only trade individual stocks." <strong>Right:</strong> Index signals set overall exposure. Individual stocks are correlated with market. When SPY crashes, 80% of stocks crash with it.</p></div>
                <div class="card"><h4>Mistake 2: Fighting the Index</h4><p><strong>Wrong:</strong> "SPY is bearish but my stocks are different." <strong>Right:</strong> Very few stocks defy strong market trends. Respect the regime.</p></div>
                <div class="card"><h4>Mistake 3: Using Single Indicator</h4><p><strong>Wrong:</strong> Acting on SPY P/C alone. <strong>Right:</strong> Need confirmation from GEX, VIX, and mega-caps. Multiple signals = higher accuracy.</p></div>
                <div class="card"><h4>Mistake 4: Ignoring Negative GEX</h4><p><strong>Wrong:</strong> "GEX doesn't matter." <strong>Right:</strong> Negative GEX is one of most dangerous conditions. Dealers amplify moves. Always reduce risk when GEX goes negative.</p></div>
            </div>
        </section>

        <!-- Part 8: Summary & Quiz -->
        <section class="content-section fade-in">
            <h2>Part 8: Summary &amp; Key Takeaways</h2>
            <div class="info-box"><div class="info-box-title">Core Principles</div>
                <ul>
                    <li><strong>Index options set WHEN, stock analysis sets WHAT:</strong> Use index signals to control overall exposure.</li>
                    <li><strong>SPY P/C &gt;1.5 or GEX &lt;$0 = danger:</strong> Reduce exposure immediately.</li>
                    <li><strong>Extreme VIX is contrarian:</strong> VIX &gt;50 = panic = buy opportunity. VIX &lt;12 = complacency = danger.</li>
                    <li><strong>Mega-caps confirm index:</strong> AAPL, MSFT, NVDA flow validates SPY signals.</li>
                    <li><strong>Negative GEX causes flash crashes:</strong> Feb 2018, Dec 2018, March 2020 all had negative GEX.</li>
                </ul>
            </div>

            <div class="quiz-section">
                <h3>Test Your Understanding</h3>
                <div class="quiz-question" id="q1">
                    <p><strong>Q1:</strong> SPY P/C is 1.55, GEX is -$1.5B, VIX is 24, all mega-caps show heavy put buying. What should you do?</p>
                    <div class="quiz-options">
                        <button onclick="checkAnswer(this, false)">Ignore it - focus on individual stocks</button>
                        <button onclick="checkAnswer(this, true)">Reduce exposure to 30-40%, tighten stops, go defensive</button>
                        <button onclick="checkAnswer(this, false)">Go to 100% cash immediately</button>
                        <button onclick="checkAnswer(this, false)">It's just noise - keep trading normally</button>
                    </div>
                    <div class="quiz-explanation" style="display:none;">All 4 signals firing = strong bearish. Reduce to 30-40% invested, tighten stops, take only A+ setups. Not 100% cash (too extreme), but very defensive.</div>
                </div>
                <div class="quiz-question" id="q2">
                    <p><strong>Q2:</strong> SPY GEX flips from +$3B to -$0.8B. What does this mean?</p>
                    <div class="quiz-options">
                        <button onclick="checkAnswer(this, false)">Market will be more stable</button>
                        <button onclick="checkAnswer(this, true)">Market regime now dangerous - dealers will amplify moves</button>
                        <button onclick="checkAnswer(this, false)">No significance - GEX doesn't impact market</button>
                        <button onclick="checkAnswer(this, false)">Bullish signal - means calls being bought</button>
                    </div>
                    <div class="quiz-explanation" style="display:none;">Negative GEX = dealers short gamma = must sell into declines = amplifies downward moves. Very dangerous. Feb 2018 Volmageddon had this exact pattern.</div>
                </div>
                <div class="quiz-question" id="q3">
                    <p><strong>Q3:</strong> VIX spikes to 48 during market crash. What's the correct interpretation?</p>
                    <div class="quiz-options">
                        <button onclick="checkAnswer(this, false)">Extremely bearish - sell everything</button>
                        <button onclick="checkAnswer(this, true)">Contrarian signal - panic levels often mark bottoms, start looking for longs</button>
                        <button onclick="checkAnswer(this, false)">Stay defensive until VIX drops to 20</button>
                        <button onclick="checkAnswer(this, false)">VIX doesn't matter for stock trading</button>
                    </div>
                    <div class="quiz-explanation" style="display:none;">Extreme VIX (&gt;40) is contrarian. VIX 48 = maximum panic = often near bottom. March 2020: VIX hit 82 on March 16 - that was the bottom. Sellers at VIX 82 got crushed.</div>
                </div>
                <div class="quiz-question" id="q4">
                    <p><strong>Q4:</strong> You have perfect bullish setup on NVDA, but SPY options show strong bearish signal. What should you do?</p>
                    <div class="quiz-options">
                        <button onclick="checkAnswer(this, false)">Skip the trade - never trade against index</button>
                        <button onclick="checkAnswer(this, false)">Take full 5% position - stock setup is too good</button>
                        <button onclick="checkAnswer(this, true)">Take the trade but reduce size to 1% and use tight stops</button>
                        <button onclick="checkAnswer(this, false)">Flip and short NVDA instead</button>
                    </div>
                    <div class="quiz-explanation" style="display:none;">Good stock in bad market = reduced size, not avoided. Take 1% instead of normal 3-5%. Tight stops. Stock might still work despite market headwind.</div>
                </div>
                <div class="quiz-question" id="q5">
                    <p><strong>Q5:</strong> Why are mega-cap options (AAPL, MSFT, NVDA) important for market timing?</p>
                    <div class="quiz-options">
                        <button onclick="checkAnswer(this, false)">They're not - only SPY matters</button>
                        <button onclick="checkAnswer(this, true)">They are 40% of SPY - their flow confirms or contradicts index signals</button>
                        <button onclick="checkAnswer(this, false)">They're more liquid than SPY</button>
                        <button onclick="checkAnswer(this, false)">They replace the need for SPY analysis</button>
                    </div>
                    <div class="quiz-explanation" style="display:none;">AAPL, MSFT, NVDA are ~40% of SPY. If all three show heavy put buying while SPY does too, that confirms the signal. If they're bullish while SPY is bearish, it's a conflicting signal (need caution).</div>
                </div>
            </div>
        </section>
    </main>

    <footer style="text-align:center; padding:40px 20px; color:#64748b; border-top:1px solid rgba(148,163,184,0.1); margin-top:60px;">
        <p>&copy; 2025 Quantitative Trading Mastery. All rights reserved.</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="../../../assets/js/shared-scripts.js"></script>
    <script>
    function copyCode(button) {
        const codeBlock = button.parentElement.nextElementSibling.querySelector('code');
        navigator.clipboard.writeText(codeBlock.textContent);
        button.textContent = 'Copied!';
        setTimeout(() => button.textContent = 'Copy', 2000);
    }

    function checkAnswer(btn, correct) {
        const question = btn.closest('.quiz-question');
        const buttons = question.querySelectorAll('.quiz-options button');
        buttons.forEach(b => { b.disabled = true; b.style.opacity = '0.6'; });
        btn.style.opacity = '1';
        btn.style.background = correct ? 'rgba(16,185,129,0.3)' : 'rgba(239,68,68,0.3)';
        btn.style.border = correct ? '2px solid #10b981' : '2px solid #ef4444';
        question.querySelector('.quiz-explanation').style.display = 'block';
    }

    function calculateMarketSignal() {
        const spyPC = parseFloat(document.getElementById('spyPC').value);
        const spyPC5day = parseFloat(document.getElementById('spyPC5day').value);
        const spyGEX = parseFloat(document.getElementById('spyGEX').value);
        const vix = parseFloat(document.getElementById('vixLevel').value);
        const megaCap = document.getElementById('megaCapSignal').value;

        let bullishScore = 0, bearishScore = 0;

        if (spyPC < 0.8) bullishScore += 2;
        else if (spyPC > 1.2) bearishScore += 2;
        if (spyPC > spyPC5day * 1.3) bearishScore += 2;
        else if (spyPC < spyPC5day * 0.7) bullishScore += 2;
        if (spyGEX > 3) bullishScore += 1;
        else if (spyGEX < 0) bearishScore += 3;
        if (vix < 15) bullishScore += 1;
        else if (vix > 25) bearishScore += 2;
        if (vix > 35) { bullishScore += 2; bearishScore -= 2; }
        if (megaCap === "BULLISH") bullishScore += 2;
        else if (megaCap === "BEARISH") bearishScore += 2;

        let signal, confidence, exposure, action;
        if (bullishScore >= 6) {
            signal = "STRONG BULLISH"; confidence = "HIGH"; exposure = "100%";
            action = "Fully invested, aggressive trading";
        } else if (bullishScore >= 4) {
            signal = "BULLISH"; confidence = "MODERATE"; exposure = "85%";
            action = "Normal trading, 2-3% positions";
        } else if (bearishScore >= 6) {
            signal = "STRONG BEARISH"; confidence = "HIGH"; exposure = "30%";
            action = "Defensive mode, reduce exposure, tight stops";
        } else if (bearishScore >= 4) {
            signal = "BEARISH"; confidence = "MODERATE"; exposure = "50%";
            action = "Reduce exposure, selective trading";
        } else {
            signal = "NEUTRAL"; confidence = "LOW"; exposure = "70%";
            action = "Balanced approach, take A setups only";
        }

        const resultDiv = document.getElementById('marketResult');
        resultDiv.style.display = 'block';
        resultDiv.innerHTML = `
            <h4 style="color:#a855f7;margin-top:0;">Market Signal Results</h4>
            <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin:10px 0;">
                <div><strong style="color:#94a3b8;">P/C Change:</strong> ${(spyPC - spyPC5day).toFixed(2)}</div>
                <div><strong style="color:#94a3b8;">Bullish Score:</strong> ${bullishScore}</div>
                <div><strong style="color:#94a3b8;">Bearish Score:</strong> ${bearishScore}</div>
                <div><strong style="color:#94a3b8;">Market Signal:</strong> ${signal}</div>
            </div>
            <div style="padding:10px;border-radius:6px;background:rgba(0,0,0,0.2);margin-top:8px;">
                <strong style="color:#a855f7;">Confidence: ${confidence}</strong><br>
                <strong style="color:#22d3ee;">Recommended Exposure: ${exposure}</strong><br>
                <span style="color:#94a3b8;">${action}</span>
            </div>
        `;
    }

    document.addEventListener('DOMContentLoaded', function() {
        // SPY P/C Chart
        const ctx1 = document.getElementById('pcRatioChart').getContext('2d');
        new Chart(ctx1, {
            type: 'line',
            data: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri'],
                datasets: [{
                    label: 'SPY Put/Call Ratio',
                    data: [0.95, 0.98, 1.02, 1.08, 1.45],
                    borderColor: '#a855f7',
                    backgroundColor: 'rgba(168,85,247,0.1)',
                    fill: true
                }, {
                    label: '5-Day Average',
                    data: [0.95, 0.95, 0.95, 0.95, 0.95],
                    borderColor: '#22d3ee',
                    borderDash: [5, 5],
                    fill: false
                }]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { labels: { color: '#94a3b8' } } },
                scales: {
                    x: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(148,163,184,0.1)' } },
                    y: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(148,163,184,0.1)' } }
                }
            }
        });

        // GEX Chart
        const ctx2 = document.getElementById('gexChart').getContext('2d');
        new Chart(ctx2, {
            type: 'bar',
            data: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri'],
                datasets: [{
                    label: 'SPY GEX ($B)',
                    data: [2.5, 1.8, 0.5, -0.3, -1.2],
                    backgroundColor: ['#10b981', '#10b981', '#f59e0b', '#ef4444', '#ef4444']
                }]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { labels: { color: '#94a3b8' } } },
                scales: {
                    x: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(148,163,184,0.1)' } },
                    y: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(148,163,184,0.1)' } }
                }
            }
        });

        // Exposure Chart
        const ctx3 = document.getElementById('exposureChart').getContext('2d');
        new Chart(ctx3, {
            type: 'bar',
            data: {
                labels: ['Strong Bullish', 'Bullish', 'Neutral', 'Bearish', 'Strong Bearish'],
                datasets: [{
                    label: 'Recommended Exposure (%)',
                    data: [100, 85, 70, 50, 30],
                    backgroundColor: ['#10b981', '#22d3ee', '#f59e0b', '#ef4444', '#7f1d1d']
                }]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { labels: { color: '#94a3b8' } } },
                scales: {
                    x: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(148,163,184,0.1)' } },
                    y: { ticks: { color: '#94a3b8', callback: v => v + '%' }, grid: { color: 'rgba(148,163,184,0.1)' }, max: 100 }
                }
            }
        });
    });
    </script>
</body>
</html>