<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Master descriptive statistics for quantitative trading. Learn mean, variance, skewness, kurtosis, and how to analyze return distributions.">
    <title>5.1 Descriptive Statistics | Quantitative Trading Mastery</title>

    <link rel="stylesheet" href="../../assets/css/shared-styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìä</text></svg>">

    <style>
        .stat-card {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.05));
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }
        .stat-card h4 {
            color: #6366f1;
            margin-bottom: 10px;
        }
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #e2e8f0;
        }
        .stat-label {
            font-size: 0.85rem;
            color: #94a3b8;
        }
        .distribution-comparison {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 25px 0;
        }
        .dist-card {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }
        .dist-card.normal { border: 2px solid #10b981; }
        .dist-card.skewed { border: 2px solid #f59e0b; }
        .dist-card.fat-tails { border: 2px solid #ef4444; }
        .dist-card h4 { margin-bottom: 15px; }
        .dist-card.normal h4 { color: #10b981; }
        .dist-card.skewed h4 { color: #f59e0b; }
        .dist-card.fat-tails h4 { color: #ef4444; }
        .moment-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .moment-table th, .moment-table td {
            padding: 12px;
            text-align: left;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .moment-table th {
            background: rgba(99, 102, 241, 0.2);
            color: #e2e8f0;
        }
        .moment-table tr:nth-child(even) {
            background: rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body>
    <nav class="module-nav-header">
        <div class="container">
            <div class="nav-content">
                <a href="../../index.html" class="nav-home">‚Üê Back to Course</a>
                <div class="nav-module-info">
                    <span class="nav-module-number">Module 5.1</span>
                    <span class="nav-module-title">Descriptive Statistics</span>
                </div>
                <a href="5.2_probability_distributions.html" class="nav-next">Next Module ‚Üí</a>
            </div>
        </div>
    </nav>

    <header class="module-hero">
        <div class="container">
            <div class="module-hero-content">
                <div class="module-breadcrumb">
                    <span>Module 5: Statistics</span>
                    <span class="breadcrumb-separator">‚Ä∫</span>
                    <span>5.1 Descriptive Statistics</span>
                </div>
                <h1>Descriptive Statistics</h1>
                <p class="module-subtitle">
                    Summarize return distributions with mean, variance, skewness, and kurtosis.
                    The foundation of risk assessment and strategy evaluation.
                </p>
                <div class="module-meta">
                    <span class="meta-item">‚è±Ô∏è 30 min read</span>
                    <span class="meta-item">üìä 4 Visualizations</span>
                    <span class="meta-item">üíª Interactive Calculator</span>
                    <span class="meta-item">‚úÖ 5 Quiz Questions</span>
                </div>
            </div>
        </div>
    </header>

    <main class="container content-wrapper">
        <!-- PART 1: WHY SHOULD I CARE? -->
        <section class="content-section fade-in">
            <h2>Part 1: Why Should I Care?</h2>

            <div class="info-box info-box-warning">
                <div class="info-box-title">Beyond Average Returns</div>
                <p>
                    A strategy with 15% average returns sounds great‚Äîuntil you discover it has extreme negative skew
                    and fat tails, meaning it occasionally blows up catastrophically. Descriptive statistics reveal
                    the full picture of risk that average returns hide.
                </p>
            </div>

            <div class="grid grid-3">
                <div class="card">
                    <h4 style="color: var(--accent-blue); margin-bottom: 1rem;">üìà Return Analysis</h4>
                    <p>Mean and median show expected performance. Differences between them reveal skewness in your returns.</p>
                </div>
                <div class="card">
                    <h4 style="color: var(--accent-blue); margin-bottom: 1rem;">‚ö†Ô∏è Risk Measurement</h4>
                    <p>Standard deviation measures volatility. Kurtosis reveals tail risk‚Äîthe probability of extreme events.</p>
                </div>
                <div class="card">
                    <h4 style="color: var(--accent-blue); margin-bottom: 1rem;">üéØ Strategy Comparison</h4>
                    <p>Compare strategies by their full distribution, not just returns. Shape matters as much as magnitude.</p>
                </div>
            </div>
        </section>

        <!-- PART 2: BUILDING INTUITION -->
        <section class="content-section fade-in">
            <h2>Part 2: Building Intuition</h2>

            <div class="info-box info-box-info">
                <div class="info-box-title">The Four Moments</div>
                <p>
                    Statisticians describe distributions using "moments"‚Äîeach reveals something different:
                    <strong>1st moment (mean)</strong> = center,
                    <strong>2nd moment (variance)</strong> = spread,
                    <strong>3rd moment (skewness)</strong> = asymmetry,
                    <strong>4th moment (kurtosis)</strong> = tail thickness.
                </p>
            </div>

            <table class="moment-table">
                <thead>
                    <tr>
                        <th>Statistic</th>
                        <th>What It Measures</th>
                        <th>Trading Interpretation</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Mean (Œº)</strong></td>
                        <td>Central tendency (average)</td>
                        <td>Expected return of strategy</td>
                    </tr>
                    <tr>
                        <td><strong>Median</strong></td>
                        <td>Middle value (50th percentile)</td>
                        <td>Typical return (robust to outliers)</td>
                    </tr>
                    <tr>
                        <td><strong>Std Dev (œÉ)</strong></td>
                        <td>Spread around mean</td>
                        <td>Volatility‚Äîrisk measure</td>
                    </tr>
                    <tr>
                        <td><strong>Skewness</strong></td>
                        <td>Asymmetry of distribution</td>
                        <td>Negative = more left tail (crash risk)</td>
                    </tr>
                    <tr>
                        <td><strong>Kurtosis</strong></td>
                        <td>Tail thickness</td>
                        <td>High = fat tails (extreme events)</td>
                    </tr>
                </tbody>
            </table>

            <h3>Distribution Shapes</h3>
            <div class="distribution-comparison">
                <div class="dist-card normal">
                    <h4>Normal Distribution</h4>
                    <svg viewBox="0 0 120 60" style="width: 100%; height: 60px;">
                        <path d="M 10 55 Q 30 55 40 40 Q 50 20 60 10 Q 70 20 80 40 Q 90 55 110 55" fill="none" stroke="#10b981" stroke-width="2"/>
                        <line x1="60" y1="10" x2="60" y2="58" stroke="#10b981" stroke-width="1" stroke-dasharray="3,3"/>
                    </svg>
                    <p style="font-size: 0.85rem; color: #94a3b8;">Skew ‚âà 0, Kurtosis ‚âà 3</p>
                    <p style="font-size: 0.85rem;">Symmetric, thin tails</p>
                </div>
                <div class="dist-card skewed">
                    <h4>Negative Skew</h4>
                    <svg viewBox="0 0 120 60" style="width: 100%; height: 60px;">
                        <path d="M 10 55 Q 20 50 30 30 Q 40 15 50 10 Q 65 15 80 35 Q 95 50 110 55" fill="none" stroke="#f59e0b" stroke-width="2"/>
                        <line x1="50" y1="10" x2="50" y2="58" stroke="#f59e0b" stroke-width="1" stroke-dasharray="3,3"/>
                    </svg>
                    <p style="font-size: 0.85rem; color: #94a3b8;">Skew < 0</p>
                    <p style="font-size: 0.85rem;">Long left tail (crash risk)</p>
                </div>
                <div class="dist-card fat-tails">
                    <h4>Fat Tails (Leptokurtic)</h4>
                    <svg viewBox="0 0 120 60" style="width: 100%; height: 60px;">
                        <path d="M 5 50 Q 20 48 35 40 Q 50 25 60 8 Q 70 25 85 40 Q 100 48 115 50" fill="none" stroke="#ef4444" stroke-width="2"/>
                        <line x1="60" y1="8" x2="60" y2="58" stroke="#ef4444" stroke-width="1" stroke-dasharray="3,3"/>
                    </svg>
                    <p style="font-size: 0.85rem; color: #94a3b8;">Kurtosis > 3</p>
                    <p style="font-size: 0.85rem;">More extreme events</p>
                </div>
            </div>
        </section>

        <!-- PART 3: THE MATHEMATICS -->
        <section class="content-section fade-in">
            <h2>Part 3: The Mathematics</h2>

            <div class="formula-box">
                <h3>Sample Mean</h3>
                <div class="formula">xÃÑ = (1/n) Œ£ x·µ¢</div>
                <p>The arithmetic average of all observations</p>
            </div>

            <div class="formula-box">
                <h3>Sample Variance & Standard Deviation</h3>
                <div class="formula">
                    s¬≤ = (1/(n-1)) Œ£ (x·µ¢ - xÃÑ)¬≤<br>
                    s = ‚àös¬≤
                </div>
                <p>Note: Use n-1 (Bessel's correction) for sample variance to get unbiased estimate</p>
            </div>

            <div class="formula-box">
                <h3>Skewness</h3>
                <div class="formula">Skew = (1/n) Œ£ [(x·µ¢ - xÃÑ)/s]¬≥</div>
                <p>Skew = 0: symmetric | Skew < 0: left tail | Skew > 0: right tail</p>
            </div>

            <div class="formula-box">
                <h3>Kurtosis (Excess)</h3>
                <div class="formula">Kurt = (1/n) Œ£ [(x·µ¢ - xÃÑ)/s]‚Å¥ - 3</div>
                <p>Excess kurtosis subtracts 3 so normal = 0. Kurt > 0 = fat tails</p>
            </div>

            <div class="formula-box">
                <h3>Percentile</h3>
                <div class="formula">P‚Çñ = value below which k% of data falls</div>
                <p>P‚ÇÖ = 5th percentile (VaR). P‚ÇÇ‚ÇÖ, P‚ÇÖ‚ÇÄ, P‚Çá‚ÇÖ = quartiles</p>
            </div>
        </section>

        <!-- PART 4: KEY PROPERTIES -->
        <section class="content-section fade-in">
            <h2>Part 4: Key Properties for Trading</h2>

            <div class="properties-list">
                <div class="property-item">
                    <span class="property-name">Mean vs Median Divergence</span>
                    <span class="property-desc">Large gap indicates skewness. Mean > Median = positive skew, Mean < Median = negative skew</span>
                </div>
                <div class="property-item">
                    <span class="property-name">Volatility Scaling</span>
                    <span class="property-desc">Annualized vol = daily vol √ó ‚àö252. Variance scales with time, std dev with ‚àötime</span>
                </div>
                <div class="property-item">
                    <span class="property-name">Fat Tails Reality</span>
                    <span class="property-desc">Real market returns have kurtosis >> 3. "6-sigma" events happen much more often than normal predicts</span>
                </div>
                <div class="property-item">
                    <span class="property-name">Negative Skew in Equities</span>
                    <span class="property-desc">Stock returns typically negatively skewed‚Äîcrashes are faster than rallies</span>
                </div>
            </div>
        </section>

        <!-- PART 5: PYTHON IMPLEMENTATION -->
        <section class="content-section fade-in">
            <h2>Part 5: Python Implementation</h2>

            <div class="code-block">
                <div class="code-header">
                    <span>Complete Descriptive Statistics Calculator</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre><code class="language-python">import numpy as np
import pandas as pd
from scipy import stats
from typing import Dict, Union
from dataclasses import dataclass


@dataclass
class DescriptiveStats:
    """Container for descriptive statistics."""
    mean: float
    median: float
    std: float
    variance: float
    skewness: float
    kurtosis: float
    min: float
    max: float
    p5: float  # 5th percentile (VaR 95%)
    p25: float  # 1st quartile
    p75: float  # 3rd quartile
    p95: float  # 95th percentile
    count: int


def calculate_descriptive_stats(
    data: Union[np.ndarray, pd.Series],
    annualize: bool = False,
    periods_per_year: int = 252
) -> DescriptiveStats:
    """
    Calculate comprehensive descriptive statistics.

    Args:
        data: Array of returns or values
        annualize: Whether to annualize mean and std
        periods_per_year: Periods per year (252 for daily)

    Returns:
        DescriptiveStats with all metrics
    """
    data = np.array(data)
    data = data[~np.isnan(data)]  # Remove NaN

    mean = np.mean(data)
    std = np.std(data, ddof=1)  # Sample std

    if annualize:
        mean = mean * periods_per_year
        std = std * np.sqrt(periods_per_year)

    return DescriptiveStats(
        mean=mean,
        median=np.median(data),
        std=std,
        variance=np.var(data, ddof=1),
        skewness=stats.skew(data),
        kurtosis=stats.kurtosis(data),  # Excess kurtosis
        min=np.min(data),
        max=np.max(data),
        p5=np.percentile(data, 5),
        p25=np.percentile(data, 25),
        p75=np.percentile(data, 75),
        p95=np.percentile(data, 95),
        count=len(data)
    )


def analyze_returns_distribution(
    returns: np.ndarray
) -> Dict:
    """
    Analyze returns distribution for trading insights.

    Args:
        returns: Array of returns

    Returns:
        Dictionary with analysis and interpretations
    """
    stats_result = calculate_descriptive_stats(returns)

    analysis = {
        'stats': stats_result,
        'interpretations': []
    }

    # Skewness interpretation
    if stats_result.skewness < -0.5:
        analysis['interpretations'].append(
            f"Negative skew ({stats_result.skewness:.2f}): "
            "Left tail risk‚Äîpotential for sudden large losses"
        )
    elif stats_result.skewness > 0.5:
        analysis['interpretations'].append(
            f"Positive skew ({stats_result.skewness:.2f}): "
            "Right tail‚Äîoccasional large gains possible"
        )

    # Kurtosis interpretation
    if stats_result.kurtosis > 1:
        analysis['interpretations'].append(
            f"High kurtosis ({stats_result.kurtosis:.2f}): "
            "Fat tails‚Äîextreme events more likely than normal"
        )
    elif stats_result.kurtosis < -0.5:
        analysis['interpretations'].append(
            f"Low kurtosis ({stats_result.kurtosis:.2f}): "
            "Thin tails‚Äîfewer extreme events"
        )

    # Mean vs Median
    mean_median_diff = (stats_result.mean - stats_result.median) / stats_result.std
    if abs(mean_median_diff) > 0.1:
        analysis['interpretations'].append(
            f"Mean-Median gap ({mean_median_diff:.2f}œÉ): "
            "Distribution is not symmetric"
        )

    # VaR estimate
    var_95 = stats_result.p5
    analysis['var_95'] = var_95
    analysis['interpretations'].append(
        f"VaR(95%): {var_95*100:.2f}% ‚Äî "
        f"5% chance of losing more than this"
    )

    return analysis


# Example usage
if __name__ == "__main__":
    np.random.seed(42)

    # Simulate strategy returns with negative skew and fat tails
    n = 1000
    normal_returns = np.random.randn(n) * 0.01
    # Add some negative outliers (crash events)
    normal_returns[np.random.choice(n, 20)] -= 0.05

    analysis = analyze_returns_distribution(normal_returns)
    stats_result = analysis['stats']

    print("=" * 50)
    print("DESCRIPTIVE STATISTICS ANALYSIS")
    print("=" * 50)
    print(f"\nMean: {stats_result.mean*100:.4f}%")
    print(f"Median: {stats_result.median*100:.4f}%")
    print(f"Std Dev: {stats_result.std*100:.4f}%")
    print(f"Skewness: {stats_result.skewness:.4f}")
    print(f"Kurtosis: {stats_result.kurtosis:.4f}")
    print(f"\nPercentiles:")
    print(f"  5th (VaR 95%): {stats_result.p5*100:.4f}%")
    print(f"  25th: {stats_result.p25*100:.4f}%")
    print(f"  75th: {stats_result.p75*100:.4f}%")
    print(f"  95th: {stats_result.p95*100:.4f}%")

    print(f"\nInterpretations:")
    for interp in analysis['interpretations']:
        print(f"  ‚Ä¢ {interp}")</code></pre>
            </div>
        </section>

        <!-- PART 6: INTERACTIVE CALCULATOR -->
        <section class="content-section fade-in">
            <h2>Part 6: Interactive Statistics Calculator</h2>

            <div class="calculator">
                <h3>Calculate Descriptive Statistics</h3>
                <p style="color: #94a3b8; margin-bottom: 20px;">
                    Enter a series of returns (comma-separated) to see all statistics.
                </p>

                <div class="input-group">
                    <label for="returnsData">Returns (%, comma-separated):</label>
                    <input type="text" id="returnsData"
                           value="1.2, -0.5, 0.8, -2.1, 1.5, 0.3, -0.8, 2.0, -1.2, 0.9, -3.5, 1.1, 0.4, -0.6, 1.8, -0.2, 0.7, -1.5, 2.2, -0.9"
                           placeholder="e.g., 1.2, -0.5, 0.8, ...">
                </div>

                <button class="btn" onclick="calculateStats()">Calculate Statistics</button>

                <div id="statsResults" style="margin-top: 20px;">
                    <!-- Results populated here -->
                </div>
            </div>

            <div class="chart-container">
                <h3>Return Distribution Histogram</h3>
                <canvas id="histogramChart"></canvas>
            </div>

            <div class="chart-container">
                <h3>Box Plot</h3>
                <canvas id="boxPlotChart"></canvas>
            </div>
        </section>

        <!-- PART 7: TRADING APPLICATIONS -->
        <section class="content-section fade-in">
            <h2>Part 7: Trading Applications</h2>

            <div class="card-grid">
                <div class="card">
                    <h4>Strategy Comparison</h4>
                    <p>Compare two strategies: same mean but different skewness means very different risk profiles.</p>
                    <div class="highlight">Prefer positive skew strategies</div>
                </div>
                <div class="card">
                    <h4>Risk-Adjusted Returns</h4>
                    <p>Sharpe ratio = mean/std, but ignores higher moments. Consider Sortino (downside only) for asymmetric returns.</p>
                    <div class="highlight">Include skewness in risk assessment</div>
                </div>
                <div class="card">
                    <h4>VaR Calculation</h4>
                    <p>5th percentile gives historical VaR. For fat-tailed distributions, parametric VaR underestimates risk.</p>
                    <div class="highlight">Use percentiles for tail risk</div>
                </div>
                <div class="card">
                    <h4>Position Sizing</h4>
                    <p>High kurtosis = more extreme outcomes. Reduce position size for fat-tailed strategies.</p>
                    <div class="highlight">Kurtosis impacts sizing</div>
                </div>
            </div>

            <div class="chart-container">
                <h3>Normal vs Actual Returns Comparison</h3>
                <canvas id="comparisonChart"></canvas>
            </div>
        </section>

        <!-- PART 8: COMMON MISTAKES -->
        <section class="content-section fade-in">
            <h2>Part 8: Common Mistakes to Avoid</h2>

            <div class="warning-box">
                <h3>Mistake 1: Assuming Normality</h3>
                <p>Most financial returns are NOT normal‚Äîthey have fat tails and negative skew. Using normal assumptions drastically underestimates tail risk.</p>
            </div>

            <div class="warning-box">
                <h3>Mistake 2: Ignoring Skewness</h3>
                <p>Two strategies with same mean and std can have very different skewness. Negative skew = hidden crash risk.</p>
            </div>

            <div class="warning-box">
                <h3>Mistake 3: Small Sample Size</h3>
                <p>Kurtosis and skewness require large samples (>100) for reliable estimates. Small samples give noisy estimates.</p>
            </div>

            <div class="warning-box">
                <h3>Mistake 4: Wrong Annualization</h3>
                <p>Mean scales linearly with time, std dev scales with ‚àötime. Don't just multiply daily std by 252.</p>
            </div>
        </section>

        <!-- SUMMARY -->
        <section class="content-section fade-in">
            <h2>Summary</h2>
            <div class="key-concept">
                <h3>Key Takeaways</h3>
                <ul>
                    <li><strong>Mean/Median:</strong> Central tendency‚Äîexpected vs typical return</li>
                    <li><strong>Std Dev:</strong> Volatility measure‚Äîscales with ‚àötime</li>
                    <li><strong>Skewness:</strong> Asymmetry‚Äînegative = crash risk</li>
                    <li><strong>Kurtosis:</strong> Tail thickness‚Äîhigh = extreme events</li>
                    <li><strong>Percentiles:</strong> Direct risk measures (VaR, drawdowns)</li>
                </ul>
            </div>

            <div class="nav-buttons">
                <a href="../module_4_volume_analysis/4.3_combined_volume_strategies.html" class="nav-btn">‚Üê Previous: Combined Volume</a>
                <a href="5.2_probability_distributions.html" class="nav-btn">Next: Probability Distributions ‚Üí</a>
            </div>
        </section>

        <!-- QUIZ -->
        <section class="content-section fade-in">
            <h2>Test Your Knowledge</h2>
            <div class="quiz-container" id="quiz">
                <div class="quiz-question">
                    <h4>Question 1: What does negative skewness indicate about a return distribution?</h4>
                    <div class="quiz-options">
                        <label><input type="radio" name="q1" value="a"> Returns are normally distributed</label>
                        <label><input type="radio" name="q1" value="b"> The distribution has a longer left tail (more large losses)</label>
                        <label><input type="radio" name="q1" value="c"> The mean is greater than the median</label>
                        <label><input type="radio" name="q1" value="d"> Volatility is decreasing</label>
                    </div>
                    <div class="quiz-feedback" id="feedback1"></div>
                </div>

                <div class="quiz-question">
                    <h4>Question 2: If excess kurtosis is 5, what does this tell you?</h4>
                    <div class="quiz-options">
                        <label><input type="radio" name="q2" value="a"> The distribution is perfectly normal</label>
                        <label><input type="radio" name="q2" value="b"> The distribution has fatter tails than normal (more extreme events)</label>
                        <label><input type="radio" name="q2" value="c"> The mean return is 5%</label>
                        <label><input type="radio" name="q2" value="d"> The standard deviation is 5</label>
                    </div>
                    <div class="quiz-feedback" id="feedback2"></div>
                </div>

                <div class="quiz-question">
                    <h4>Question 3: How do you annualize daily standard deviation?</h4>
                    <div class="quiz-options">
                        <label><input type="radio" name="q3" value="a"> Multiply by 252</label>
                        <label><input type="radio" name="q3" value="b"> Multiply by ‚àö252</label>
                        <label><input type="radio" name="q3" value="c"> Divide by 252</label>
                        <label><input type="radio" name="q3" value="d"> Divide by ‚àö252</label>
                    </div>
                    <div class="quiz-feedback" id="feedback3"></div>
                </div>

                <div class="quiz-question">
                    <h4>Question 4: What does the 5th percentile represent in risk management?</h4>
                    <div class="quiz-options">
                        <label><input type="radio" name="q4" value="a"> The average return</label>
                        <label><input type="radio" name="q4" value="b"> The VaR at 95% confidence‚Äîloss exceeded 5% of the time</label>
                        <label><input type="radio" name="q4" value="c"> The maximum possible loss</label>
                        <label><input type="radio" name="q4" value="d"> The volatility</label>
                    </div>
                    <div class="quiz-feedback" id="feedback4"></div>
                </div>

                <div class="quiz-question">
                    <h4>Question 5: If mean > median, what does this suggest?</h4>
                    <div class="quiz-options">
                        <label><input type="radio" name="q5" value="a"> Negative skewness</label>
                        <label><input type="radio" name="q5" value="b"> Positive skewness (right tail pulls mean up)</label>
                        <label><input type="radio" name="q5" value="c"> Normal distribution</label>
                        <label><input type="radio" name="q5" value="d"> High kurtosis</label>
                    </div>
                    <div class="quiz-feedback" id="feedback5"></div>
                </div>

                <button class="btn" onclick="checkQuiz()">Submit Answers</button>
                <div class="quiz-score" id="quizScore"></div>
            </div>
        </section>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="../../assets/js/shared-scripts.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>

    <script>
        let histogramChart, boxPlotChart, comparisonChart;

        function initializeCharts() {
            calculateStats();
            initComparisonChart();
        }

        function calculateStats() {
            const input = document.getElementById('returnsData').value;
            const returns = input.split(',').map(x => parseFloat(x.trim()) / 100);

            // Calculate statistics
            const n = returns.length;
            const mean = returns.reduce((a, b) => a + b, 0) / n;
            const median = [...returns].sort((a, b) => a - b)[Math.floor(n / 2)];
            const variance = returns.reduce((sum, x) => sum + (x - mean) ** 2, 0) / (n - 1);
            const std = Math.sqrt(variance);

            // Skewness
            const skewness = returns.reduce((sum, x) => sum + ((x - mean) / std) ** 3, 0) / n;

            // Kurtosis (excess)
            const kurtosis = returns.reduce((sum, x) => sum + ((x - mean) / std) ** 4, 0) / n - 3;

            // Percentiles
            const sorted = [...returns].sort((a, b) => a - b);
            const p5 = sorted[Math.floor(n * 0.05)];
            const p25 = sorted[Math.floor(n * 0.25)];
            const p75 = sorted[Math.floor(n * 0.75)];
            const p95 = sorted[Math.floor(n * 0.95)];

            // Display results
            document.getElementById('statsResults').innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px;">
                    <div class="stat-card">
                        <h4>Mean</h4>
                        <div class="stat-value">${(mean * 100).toFixed(3)}%</div>
                    </div>
                    <div class="stat-card">
                        <h4>Median</h4>
                        <div class="stat-value">${(median * 100).toFixed(3)}%</div>
                    </div>
                    <div class="stat-card">
                        <h4>Std Dev</h4>
                        <div class="stat-value">${(std * 100).toFixed(3)}%</div>
                    </div>
                    <div class="stat-card">
                        <h4>Skewness</h4>
                        <div class="stat-value" style="color: ${skewness < -0.5 ? '#ef4444' : skewness > 0.5 ? '#10b981' : '#e2e8f0'}">${skewness.toFixed(3)}</div>
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px;">
                    <div class="stat-card">
                        <h4>Kurtosis</h4>
                        <div class="stat-value" style="color: ${kurtosis > 1 ? '#ef4444' : '#e2e8f0'}">${kurtosis.toFixed(3)}</div>
                    </div>
                    <div class="stat-card">
                        <h4>5th %ile (VaR)</h4>
                        <div class="stat-value" style="color: #ef4444">${(p5 * 100).toFixed(3)}%</div>
                    </div>
                    <div class="stat-card">
                        <h4>Min</h4>
                        <div class="stat-value">${(Math.min(...returns) * 100).toFixed(3)}%</div>
                    </div>
                    <div class="stat-card">
                        <h4>Max</h4>
                        <div class="stat-value">${(Math.max(...returns) * 100).toFixed(3)}%</div>
                    </div>
                </div>
                <div class="info-box info-box-info" style="margin-top: 15px;">
                    <p><strong>Interpretation:</strong></p>
                    <p>${skewness < -0.5 ? '‚ö†Ô∏è Negative skew indicates left tail risk (potential crashes)' : skewness > 0.5 ? '‚úì Positive skew‚Äîoccasional large gains' : '‚úì Approximately symmetric distribution'}</p>
                    <p>${kurtosis > 1 ? '‚ö†Ô∏è Fat tails‚Äîextreme events more likely than normal distribution predicts' : '‚úì Tails similar to normal distribution'}</p>
                </div>
            `;

            // Update histogram
            updateHistogram(returns);
            updateBoxPlot(returns, mean, std, p25, median, p75);
        }

        function updateHistogram(returns) {
            const ctx = document.getElementById('histogramChart').getContext('2d');

            // Create bins
            const min = Math.min(...returns);
            const max = Math.max(...returns);
            const binCount = 15;
            const binWidth = (max - min) / binCount;
            const bins = Array(binCount).fill(0);
            const binLabels = [];

            for (let i = 0; i < binCount; i++) {
                const binStart = min + i * binWidth;
                binLabels.push((binStart * 100).toFixed(1) + '%');
            }

            returns.forEach(r => {
                const binIndex = Math.min(Math.floor((r - min) / binWidth), binCount - 1);
                bins[binIndex]++;
            });

            if (histogramChart) histogramChart.destroy();

            histogramChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: binLabels,
                    datasets: [{
                        label: 'Frequency',
                        data: bins,
                        backgroundColor: 'rgba(99, 102, 241, 0.6)',
                        borderColor: 'rgba(99, 102, 241, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(148, 163, 184, 0.1)' } },
                        y: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(148, 163, 184, 0.1)' } }
                    }
                }
            });
        }

        function updateBoxPlot(returns, mean, std, p25, median, p75) {
            const ctx = document.getElementById('boxPlotChart').getContext('2d');

            if (boxPlotChart) boxPlotChart.destroy();

            const min = Math.min(...returns);
            const max = Math.max(...returns);

            boxPlotChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Distribution'],
                    datasets: [
                        { label: 'Min to Q1', data: [(p25 - min) * 100], backgroundColor: 'rgba(148, 163, 184, 0.3)' },
                        { label: 'Q1 to Median', data: [(median - p25) * 100], backgroundColor: 'rgba(99, 102, 241, 0.6)' },
                        { label: 'Median to Q3', data: [(p75 - median) * 100], backgroundColor: 'rgba(99, 102, 241, 0.6)' },
                        { label: 'Q3 to Max', data: [(max - p75) * 100], backgroundColor: 'rgba(148, 163, 184, 0.3)' }
                    ]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    plugins: {
                        legend: { display: false },
                        title: { display: true, text: `Quartiles: Q1=${(p25*100).toFixed(2)}%, Median=${(median*100).toFixed(2)}%, Q3=${(p75*100).toFixed(2)}%`, color: '#94a3b8' }
                    },
                    scales: {
                        x: { stacked: true, ticks: { color: '#94a3b8' }, grid: { color: 'rgba(148, 163, 184, 0.1)' } },
                        y: { stacked: true, ticks: { color: '#94a3b8' }, grid: { display: false } }
                    }
                }
            });
        }

        function initComparisonChart() {
            const ctx = document.getElementById('comparisonChart').getContext('2d');

            // Generate normal and fat-tailed distributions
            const x = [];
            const normal = [];
            const fatTail = [];

            for (let i = -4; i <= 4; i += 0.1) {
                x.push(i.toFixed(1));
                normal.push(Math.exp(-i * i / 2) / Math.sqrt(2 * Math.PI));
                // Student-t with df=3 (fat tails)
                fatTail.push(0.37 * Math.pow(1 + i * i / 3, -2));
            }

            comparisonChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: x,
                    datasets: [
                        { label: 'Normal', data: normal, borderColor: '#10b981', fill: false, pointRadius: 0 },
                        { label: 'Fat Tails (t-dist)', data: fatTail, borderColor: '#ef4444', fill: false, pointRadius: 0 }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { labels: { color: '#e2e8f0' } },
                        title: { display: true, text: 'Fat tails have more probability in extremes', color: '#94a3b8' }
                    },
                    scales: {
                        x: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(148, 163, 184, 0.1)' } },
                        y: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(148, 163, 184, 0.1)' } }
                    }
                }
            });
        }

        function checkQuiz() {
            const answers = {
                q1: { correct: 'b', explanation: 'Negative skewness means the distribution has a longer left tail, indicating more frequent large losses.' },
                q2: { correct: 'b', explanation: 'Excess kurtosis > 0 means fatter tails than normal‚Äîextreme events are more likely.' },
                q3: { correct: 'b', explanation: 'Standard deviation scales with the square root of time, so multiply daily std by ‚àö252.' },
                q4: { correct: 'b', explanation: 'The 5th percentile is the VaR at 95% confidence‚Äîthe loss exceeded only 5% of the time.' },
                q5: { correct: 'b', explanation: 'When mean > median, the right tail pulls the mean up, indicating positive skewness.' }
            };

            let score = 0;
            for (const [q, data] of Object.entries(answers)) {
                const selected = document.querySelector(`input[name="${q}"]:checked`);
                const feedback = document.getElementById(`feedback${q.slice(1)}`);
                if (selected && selected.value === data.correct) {
                    score++;
                    feedback.innerHTML = `<span style="color: #10b981;">‚úì Correct!</span> ${data.explanation}`;
                } else {
                    feedback.innerHTML = `<span style="color: #ef4444;">‚úó Incorrect.</span> ${data.explanation}`;
                }
                feedback.style.display = 'block';
            }

            document.getElementById('quizScore').innerHTML = `<h3>Score: ${score}/5 (${score * 20}%)</h3>`;
        }

        document.addEventListener('DOMContentLoaded', initializeCharts);
    </script>
</body>
</html>