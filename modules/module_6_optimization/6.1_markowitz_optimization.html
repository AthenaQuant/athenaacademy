<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Master Markowitz Mean-Variance Optimization for quantitative trading. Learn Modern Portfolio Theory, efficient frontier, and optimal portfolio construction.">
    <title>6.1 Markowitz Mean-Variance Optimization | Quantitative Trading Mastery</title>

    <link rel="stylesheet" href="../../assets/css/shared-styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìà</text></svg>">

    <style>
        .key-concept { background: var(--bg-card); border-left: 4px solid var(--accent-cyan); padding: 1.5rem; border-radius: 0 var(--radius-md) var(--radius-md) 0; margin: 1.5rem 0; }
        .key-concept h3 { color: var(--accent-cyan); margin-bottom: 1rem; }
        .important-note { background: var(--warning-bg); border-left: 4px solid var(--warning); padding: 1.5rem; border-radius: 0 var(--radius-md) var(--radius-md) 0; margin: 1.5rem 0; }
        .important-note h3 { color: var(--warning); margin-bottom: 0.5rem; }
        .calculator-container { background: var(--bg-card); border-radius: var(--radius-lg); padding: 2rem; margin: 2rem 0; border: 1px solid rgba(255,255,255,0.1); }
        .calculator-container h3 { color: var(--accent-purple); margin-bottom: 1.5rem; }
        .input-group { margin-bottom: 1rem; }
        .input-group label { display: block; margin-bottom: 0.5rem; color: var(--text-secondary); }
        .input-group input, .input-group select { width: 100%; padding: 0.75rem; background: var(--bg-secondary); border: 1px solid rgba(255,255,255,0.1); border-radius: var(--radius-md); color: var(--text-primary); font-size: 1rem; }
        .input-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; }
        .calculate-btn { background: var(--gradient-secondary); color: white; border: none; padding: 1rem 2rem; border-radius: var(--radius-md); cursor: pointer; font-size: 1rem; font-weight: 600; width: 100%; margin-top: 1rem; transition: transform 0.2s, box-shadow 0.2s; }
        .calculate-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4); }
        .results-container { background: var(--bg-secondary); border-radius: var(--radius-md); padding: 1.5rem; margin-top: 1.5rem; }
        .result-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; }
        .result-item { text-align: center; padding: 1rem; background: var(--bg-tertiary); border-radius: var(--radius-md); }
        .result-label { font-size: 0.85rem; color: var(--text-muted); display: block; margin-bottom: 0.5rem; }
        .result-value { font-size: 1.25rem; font-weight: 600; color: var(--text-primary); }
        .quiz-container { background: var(--bg-card); border-radius: var(--radius-lg); padding: 2rem; margin: 2rem 0; }
        .quiz-question { margin-bottom: 2rem; padding-bottom: 2rem; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .quiz-question:last-child { border-bottom: none; }
        .quiz-question h4 { color: var(--text-primary); margin-bottom: 1rem; }
        .quiz-options { display: flex; flex-direction: column; gap: 0.5rem; }
        .quiz-options button { background: var(--bg-secondary); border: 2px solid transparent; padding: 1rem; border-radius: var(--radius-md); color: var(--text-secondary); cursor: pointer; text-align: left; transition: all 0.2s; }
        .quiz-options button:hover:not(:disabled) { border-color: var(--accent-blue); background: var(--bg-tertiary); }
        .quiz-options button:disabled { cursor: not-allowed; opacity: 0.7; }
        .quiz-feedback { margin-top: 1rem; padding: 1rem; border-radius: var(--radius-md); display: none; }
        .quiz-feedback .correct { background: var(--success-bg); color: var(--success); }
        .quiz-feedback .incorrect { background: var(--error-bg); color: var(--error); }
        .score-container { text-align: center; padding: 2rem; background: var(--gradient-secondary); border-radius: var(--radius-lg); margin-top: 2rem; display: none; }
        .code-block { background: #1a1f2e; border-radius: var(--radius-lg); overflow: hidden; margin: 1.5rem 0; }
        .code-header { display: flex; align-items: center; justify-content: space-between; padding: 0.75rem 1rem; background: var(--bg-tertiary); border-bottom: 1px solid rgba(255,255,255,0.1); }
        .code-header span { color: var(--text-muted); font-size: 0.85rem; }
        .code-block pre { margin: 0; padding: 1.5rem; overflow-x: auto; }
        .code-block code { font-family: 'JetBrains Mono', 'Fira Code', monospace; font-size: 0.9rem; line-height: 1.6; }
        .chart-container { background: var(--bg-card); border-radius: var(--radius-lg); padding: 1.5rem; margin: 2rem 0; border: 1px solid rgba(255,255,255,0.1); position: relative; height: 400px; }
        .chart-container canvas { max-height: 350px; }
        .portfolio-weights { display: flex; gap: 0.5rem; flex-wrap: wrap; margin: 1rem 0; }
        .weight-badge { background: var(--bg-secondary); padding: 0.5rem 1rem; border-radius: var(--radius-md); font-size: 0.9rem; }
        .weight-badge span { color: var(--accent-blue); font-weight: 600; }
    </style>
</head>
<body>
    <nav class="module-nav-header">
        <div class="container">
            <div class="nav-content">
                <a href="../../index.html" class="nav-home">‚Üê Back to Course</a>
                <div class="nav-module-info">
                    <span class="nav-module-number">Module 6.1</span>
                    <span class="nav-module-title">Markowitz Optimization</span>
                </div>
                <a href="6.2_kelly_criterion.html" class="nav-next">Next Module ‚Üí</a>
            </div>
        </div>
    </nav>

    <header class="module-hero">
        <div class="container">
            <div class="module-hero-content">
                <div class="module-breadcrumb">
                    <span>Module 6: Optimization & Portfolio Theory</span>
                    <span class="breadcrumb-separator">‚Ä∫</span>
                    <span>6.1 Markowitz Mean-Variance Optimization</span>
                </div>
                <h1>Markowitz Mean-Variance Optimization</h1>
                <p class="module-subtitle">
                    Build optimal portfolios using Modern Portfolio Theory. Master the efficient frontier
                    and understand the mathematical foundation of portfolio construction.
                </p>
                <div class="module-meta">
                    <span class="meta-item">‚è±Ô∏è 45 min read</span>
                    <span class="meta-item">üìä 4 Visualizations</span>
                    <span class="meta-item">üíª Portfolio Optimizer</span>
                    <span class="meta-item">‚úÖ 5 Quiz Questions</span>
                </div>
            </div>
        </div>
    </header>

    <main class="container content-wrapper">
        <!-- Part 1: Why Should I Care? -->
        <section class="content-section fade-in">
            <h2>Part 1: Why Should I Care?</h2>

            <div class="important-note">
                <h3>‚ö†Ô∏è The Nobel Prize-Winning Framework</h3>
                <p>
                    Harry Markowitz won the 1990 Nobel Prize for this work. Every institutional portfolio manager,
                    robo-advisor, and pension fund uses some variant of mean-variance optimization. Understanding
                    MPT is <strong>non-negotiable</strong> for quantitative finance careers.
                </p>
            </div>

            <div class="key-concept">
                <h3>The Core Insight</h3>
                <p><strong>Diversification is the only "free lunch" in finance.</strong></p>
                <p style="margin-top: 1rem;">
                    By combining assets that don't move perfectly together, you can achieve the same expected return
                    with <em>less risk</em>, or higher return for the <em>same risk</em>. Markowitz gave us the
                    mathematical framework to find the optimal combination.
                </p>
            </div>

            <div class="card-grid">
                <div class="card">
                    <h4 style="color: var(--accent-blue);">üìä Institutional Standard</h4>
                    <p>Pension funds, endowments, and sovereign wealth funds all use MVO or its extensions for strategic asset allocation.</p>
                </div>
                <div class="card">
                    <h4 style="color: var(--accent-purple);">ü§ñ Robo-Advisors</h4>
                    <p>Wealthfront, Betterment, and others build portfolios using mean-variance optimization principles.</p>
                </div>
                <div class="card">
                    <h4 style="color: var(--accent-cyan);">üìà Risk Budgeting</h4>
                    <p>Understanding how assets contribute to portfolio risk is essential for proper position sizing.</p>
                </div>
            </div>
        </section>

        <!-- Part 2: Building Intuition -->
        <section class="content-section fade-in">
            <h2>Part 2: Building Intuition</h2>

            <h3>The Two-Asset Case</h3>
            <p>Consider two assets: Stocks (high return, high risk) and Bonds (low return, low risk).</p>

            <div class="info-box info-box-info">
                <div class="info-box-title">Example: Stocks vs Bonds</div>
                <table class="data-table">
                    <thead>
                        <tr><th>Asset</th><th>Expected Return</th><th>Volatility</th><th>Correlation</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>Stocks</td><td>10%</td><td>20%</td><td rowspan="2">0.2</td></tr>
                        <tr><td>Bonds</td><td>4%</td><td>5%</td></tr>
                    </tbody>
                </table>
            </div>

            <p style="margin-top: 1rem;">
                <strong>Key insight:</strong> Because correlation < 1, the portfolio volatility is <em>less than</em>
                the weighted average of individual volatilities. This is the diversification benefit!
            </p>

            <div class="key-concept">
                <h3>The Efficient Frontier</h3>
                <p>The efficient frontier is the set of portfolios that:</p>
                <ul style="margin-top: 0.5rem; color: var(--text-secondary);">
                    <li>Maximize return for a given level of risk, OR</li>
                    <li>Minimize risk for a given level of return</li>
                </ul>
                <p style="margin-top: 1rem;">
                    Any rational investor should only hold portfolios <em>on</em> the efficient frontier.
                    Portfolios below the frontier are suboptimal‚Äîyou can do better.
                </p>
            </div>

            <div class="chart-container">
                <h4 style="margin-bottom: 1rem;">Efficient Frontier Visualization</h4>
                <canvas id="efficientFrontierChart" height="350"></canvas>
            </div>
        </section>

        <!-- Part 3: The Mathematics -->
        <section class="content-section fade-in">
            <h2>Part 3: The Mathematics</h2>

            <h3>Portfolio Return</h3>
            <div class="formula-box">
                <div class="formula" style="text-align: center; font-size: 1.3rem; padding: 1rem;">
                    E[R_p] = Œ£ w·µ¢ √ó E[R·µ¢] = w'Œº
                </div>
                <p style="text-align: center; color: var(--text-muted);">
                    Portfolio return is the weighted average of individual returns
                </p>
            </div>

            <h3>Portfolio Variance</h3>
            <div class="formula-box">
                <div class="formula" style="text-align: center; font-size: 1.2rem; padding: 1rem;">
                    œÉ¬≤_p = Œ£·µ¢ Œ£‚±º w·µ¢w‚±ºœÉ·µ¢œÉ‚±ºœÅ·µ¢‚±º = w'Œ£w
                </div>
                <p style="text-align: center; color: var(--text-muted);">
                    Where Œ£ is the covariance matrix
                </p>
            </div>

            <h3>The Optimization Problem</h3>
            <div class="formula-box">
                <h4>Minimize Risk for Target Return</h4>
                <div class="formula" style="text-align: center; font-size: 1.1rem; padding: 1rem;">
                    min w'Œ£w
                </div>
                <p style="text-align: center; color: var(--text-muted);">Subject to:</p>
                <div class="formula" style="text-align: center; font-size: 1rem; padding: 0.5rem;">
                    w'Œº = target return<br>
                    w'1 = 1 (weights sum to 1)<br>
                    w·µ¢ ‚â• 0 (no short selling, optional)
                </div>
            </div>

            <div class="important-note">
                <h3>‚ö†Ô∏è The Covariance Matrix is Key</h3>
                <p>
                    The quality of your optimization depends entirely on your covariance estimates. Garbage in = garbage out.
                    With N assets, you need to estimate N(N+1)/2 parameters. For 100 assets, that's 5,050 parameters!
                </p>
            </div>
        </section>

        <!-- Part 4: Python Implementation -->
        <section class="content-section fade-in">
            <h2>Part 4: Python Implementation</h2>

            <div class="code-block">
                <div class="code-header">
                    <span>markowitz_optimization.py</span>
                    <button onclick="copyCode(this)" style="background: var(--bg-secondary); border: 1px solid rgba(255,255,255,0.2); padding: 0.5rem 1rem; border-radius: var(--radius-sm); color: var(--text-secondary); cursor: pointer;">Copy</button>
                </div>
                <pre><code class="language-python">"""
Markowitz Mean-Variance Optimization
=====================================
Build optimal portfolios using Modern Portfolio Theory.
"""

import numpy as np
from scipy.optimize import minimize
import matplotlib.pyplot as plt

class MarkowitzOptimizer:
    """Mean-variance portfolio optimization."""

    def __init__(self, returns: np.ndarray, cov_matrix: np.ndarray,
                 asset_names: list = None):
        """
        Initialize optimizer.

        Parameters
        ----------
        returns : np.ndarray
            Expected returns for each asset
        cov_matrix : np.ndarray
            Covariance matrix of returns
        asset_names : list
            Names of assets (optional)
        """
        self.returns = np.array(returns)
        self.cov = np.array(cov_matrix)
        self.n_assets = len(returns)
        self.names = asset_names or [f"Asset_{i}" for i in range(self.n_assets)]

    def portfolio_return(self, weights: np.ndarray) -> float:
        """Calculate portfolio expected return."""
        return np.dot(weights, self.returns)

    def portfolio_volatility(self, weights: np.ndarray) -> float:
        """Calculate portfolio volatility."""
        return np.sqrt(np.dot(weights.T, np.dot(self.cov, weights)))

    def sharpe_ratio(self, weights: np.ndarray, risk_free: float = 0.02) -> float:
        """Calculate Sharpe ratio."""
        ret = self.portfolio_return(weights)
        vol = self.portfolio_volatility(weights)
        return (ret - risk_free) / vol

    def minimize_volatility(self, target_return: float = None,
                           allow_short: bool = False) -> dict:
        """
        Find minimum volatility portfolio.

        Parameters
        ----------
        target_return : float
            Target portfolio return (if None, find global min vol)
        allow_short : bool
            Allow short selling (negative weights)
        """
        n = self.n_assets
        init_weights = np.ones(n) / n

        # Constraints
        constraints = [{'type': 'eq', 'fun': lambda w: np.sum(w) - 1}]

        if target_return is not None:
            constraints.append({
                'type': 'eq',
                'fun': lambda w: self.portfolio_return(w) - target_return
            })

        # Bounds
        bounds = None if allow_short else tuple((0, 1) for _ in range(n))

        # Optimize
        result = minimize(
            self.portfolio_volatility,
            init_weights,
            method='SLSQP',
            bounds=bounds,
            constraints=constraints
        )

        weights = result.x
        return {
            'weights': weights,
            'return': self.portfolio_return(weights),
            'volatility': self.portfolio_volatility(weights),
            'sharpe': self.sharpe_ratio(weights)
        }

    def maximize_sharpe(self, risk_free: float = 0.02,
                       allow_short: bool = False) -> dict:
        """Find maximum Sharpe ratio portfolio (tangency portfolio)."""
        n = self.n_assets
        init_weights = np.ones(n) / n

        def neg_sharpe(w):
            return -self.sharpe_ratio(w, risk_free)

        constraints = [{'type': 'eq', 'fun': lambda w: np.sum(w) - 1}]
        bounds = None if allow_short else tuple((0, 1) for _ in range(n))

        result = minimize(
            neg_sharpe,
            init_weights,
            method='SLSQP',
            bounds=bounds,
            constraints=constraints
        )

        weights = result.x
        return {
            'weights': weights,
            'return': self.portfolio_return(weights),
            'volatility': self.portfolio_volatility(weights),
            'sharpe': self.sharpe_ratio(weights, risk_free)
        }

    def efficient_frontier(self, n_points: int = 50,
                          allow_short: bool = False) -> tuple:
        """Generate efficient frontier."""
        # Find return range
        min_ret = self.minimize_volatility(allow_short=allow_short)['return']
        max_ret = np.max(self.returns)

        target_returns = np.linspace(min_ret, max_ret, n_points)
        volatilities = []
        all_weights = []

        for target in target_returns:
            try:
                result = self.minimize_volatility(target, allow_short)
                volatilities.append(result['volatility'])
                all_weights.append(result['weights'])
            except:
                volatilities.append(np.nan)
                all_weights.append(None)

        return target_returns, np.array(volatilities), all_weights


# Example usage
if __name__ == "__main__":
    # Example: 3-asset portfolio
    expected_returns = np.array([0.12, 0.08, 0.05])  # Stocks, Bonds, Cash
    cov_matrix = np.array([
        [0.04, 0.006, 0.002],   # Stocks: 20% vol
        [0.006, 0.0025, 0.001], # Bonds: 5% vol
        [0.002, 0.001, 0.0001]  # Cash: 1% vol
    ])
    asset_names = ['Stocks', 'Bonds', 'Cash']

    optimizer = MarkowitzOptimizer(expected_returns, cov_matrix, asset_names)

    # Find optimal portfolios
    min_vol = optimizer.minimize_volatility()
    max_sharpe = optimizer.maximize_sharpe()

    print("Minimum Volatility Portfolio:")
    for name, w in zip(asset_names, min_vol['weights']):
        print(f"  {name}: {w:.1%}")
    print(f"  Return: {min_vol['return']:.2%}, Vol: {min_vol['volatility']:.2%}")

    print("\nMaximum Sharpe Ratio Portfolio:")
    for name, w in zip(asset_names, max_sharpe['weights']):
        print(f"  {name}: {w:.1%}")
    print(f"  Return: {max_sharpe['return']:.2%}, Vol: {max_sharpe['volatility']:.2%}")
    print(f"  Sharpe: {max_sharpe['sharpe']:.2f}")</code></pre>
            </div>
        </section>

        <!-- Part 5: Interactive Calculator -->
        <section class="content-section fade-in">
            <h2>Part 5: Portfolio Optimizer</h2>

            <div class="calculator-container">
                <h3>üéØ Mean-Variance Portfolio Optimizer</h3>
                <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                    Enter expected returns and volatilities for 3 assets to find optimal portfolios.
                </p>

                <h4 style="margin-bottom: 1rem;">Asset Parameters</h4>
                <div class="input-row">
                    <div class="input-group">
                        <label>Asset 1 Return (%)</label>
                        <input type="number" id="ret1" value="12" step="0.1">
                    </div>
                    <div class="input-group">
                        <label>Asset 1 Volatility (%)</label>
                        <input type="number" id="vol1" value="20" step="0.1">
                    </div>
                </div>
                <div class="input-row">
                    <div class="input-group">
                        <label>Asset 2 Return (%)</label>
                        <input type="number" id="ret2" value="7" step="0.1">
                    </div>
                    <div class="input-group">
                        <label>Asset 2 Volatility (%)</label>
                        <input type="number" id="vol2" value="10" step="0.1">
                    </div>
                </div>
                <div class="input-row">
                    <div class="input-group">
                        <label>Asset 3 Return (%)</label>
                        <input type="number" id="ret3" value="4" step="0.1">
                    </div>
                    <div class="input-group">
                        <label>Asset 3 Volatility (%)</label>
                        <input type="number" id="vol3" value="5" step="0.1">
                    </div>
                </div>
                <div class="input-row">
                    <div class="input-group">
                        <label>Correlation (1-2)</label>
                        <input type="number" id="corr12" value="0.3" step="0.1" min="-1" max="1">
                    </div>
                    <div class="input-group">
                        <label>Correlation (1-3)</label>
                        <input type="number" id="corr13" value="0.1" step="0.1" min="-1" max="1">
                    </div>
                    <div class="input-group">
                        <label>Correlation (2-3)</label>
                        <input type="number" id="corr23" value="0.4" step="0.1" min="-1" max="1">
                    </div>
                </div>

                <button class="calculate-btn" onclick="optimizePortfolio()">Find Optimal Portfolio</button>

                <div class="results-container" id="resultsContainer" style="display: none;">
                    <h4 style="margin-bottom: 1rem; color: var(--accent-cyan);">Maximum Sharpe Ratio Portfolio</h4>
                    <div class="portfolio-weights" id="weightsDisplay"></div>
                    <div class="result-grid" style="margin-top: 1rem;">
                        <div class="result-item">
                            <span class="result-label">Expected Return</span>
                            <span class="result-value" id="optReturn">-</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Volatility</span>
                            <span class="result-value" id="optVol">-</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Sharpe Ratio</span>
                            <span class="result-value" id="optSharpe">-</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Part 6: Key Takeaways -->
        <section class="content-section fade-in">
            <h2>Part 6: Key Takeaways</h2>

            <div class="card" style="padding: 2rem;">
                <div style="display: grid; gap: 1.5rem;">
                    <div style="display: flex; gap: 1rem; align-items: flex-start;">
                        <span style="background: var(--accent-blue); color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0;">1</span>
                        <div>
                            <strong style="color: var(--text-primary);">Diversification reduces risk without sacrificing return</strong>
                            <p style="color: var(--text-secondary); margin: 0.5rem 0 0;">When correlation < 1, portfolio volatility < weighted average volatility.</p>
                        </div>
                    </div>
                    <div style="display: flex; gap: 1rem; align-items: flex-start;">
                        <span style="background: var(--accent-blue); color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0;">2</span>
                        <div>
                            <strong style="color: var(--text-primary);">The efficient frontier defines optimal portfolios</strong>
                            <p style="color: var(--text-secondary); margin: 0.5rem 0 0;">Rational investors should only hold portfolios on the frontier.</p>
                        </div>
                    </div>
                    <div style="display: flex; gap: 1rem; align-items: flex-start;">
                        <span style="background: var(--accent-blue); color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0;">3</span>
                        <div>
                            <strong style="color: var(--text-primary);">Covariance estimation is the critical challenge</strong>
                            <p style="color: var(--text-secondary); margin: 0.5rem 0 0;">Poor covariance estimates lead to unstable, extreme portfolios.</p>
                        </div>
                    </div>
                    <div style="display: flex; gap: 1rem; align-items: flex-start;">
                        <span style="background: var(--accent-blue); color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0;">4</span>
                        <div>
                            <strong style="color: var(--text-primary);">Constraints improve real-world performance</strong>
                            <p style="color: var(--text-secondary); margin: 0.5rem 0 0;">No short-selling, position limits, and turnover constraints reduce overfitting.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Part 7: Quiz -->
        <section class="content-section fade-in">
            <h2>Part 7: Knowledge Check</h2>

            <div class="quiz-container">
                <div class="quiz-question" id="q1">
                    <h4>1. What does the efficient frontier represent?</h4>
                    <div class="quiz-options">
                        <button onclick="checkAnswer(1, 'a')">a) All possible portfolios</button>
                        <button onclick="checkAnswer(1, 'b')">b) Portfolios with maximum return for each risk level</button>
                        <button onclick="checkAnswer(1, 'c')">c) The highest returning portfolio</button>
                        <button onclick="checkAnswer(1, 'd')">d) Portfolios with equal weights</button>
                    </div>
                    <div class="quiz-feedback" id="feedback1"></div>
                </div>

                <div class="quiz-question" id="q2">
                    <h4>2. If two assets have correlation = 1, what happens to diversification benefits?</h4>
                    <div class="quiz-options">
                        <button onclick="checkAnswer(2, 'a')">a) Diversification is maximized</button>
                        <button onclick="checkAnswer(2, 'b')">b) There are no diversification benefits</button>
                        <button onclick="checkAnswer(2, 'c')">c) Risk is eliminated</button>
                        <button onclick="checkAnswer(2, 'd')">d) Returns are doubled</button>
                    </div>
                    <div class="quiz-feedback" id="feedback2"></div>
                </div>

                <div class="quiz-question" id="q3">
                    <h4>3. What is the tangency portfolio?</h4>
                    <div class="quiz-options">
                        <button onclick="checkAnswer(3, 'a')">a) Minimum variance portfolio</button>
                        <button onclick="checkAnswer(3, 'b')">b) Maximum return portfolio</button>
                        <button onclick="checkAnswer(3, 'c')">c) Maximum Sharpe ratio portfolio</button>
                        <button onclick="checkAnswer(3, 'd')">d) Equal-weighted portfolio</button>
                    </div>
                    <div class="quiz-feedback" id="feedback3"></div>
                </div>

                <div class="quiz-question" id="q4">
                    <h4>4. Why do real-world MVO portfolios often perform poorly out-of-sample?</h4>
                    <div class="quiz-options">
                        <button onclick="checkAnswer(4, 'a')">a) The math is wrong</button>
                        <button onclick="checkAnswer(4, 'b')">b) Covariance and return estimates are noisy</button>
                        <button onclick="checkAnswer(4, 'c')">c) Markets are always efficient</button>
                        <button onclick="checkAnswer(4, 'd')">d) Computers are too slow</button>
                    </div>
                    <div class="quiz-feedback" id="feedback4"></div>
                </div>

                <div class="quiz-question" id="q5">
                    <h4>5. Portfolio variance formula w'Œ£w shows that variance depends on:</h4>
                    <div class="quiz-options">
                        <button onclick="checkAnswer(5, 'a')">a) Only individual asset variances</button>
                        <button onclick="checkAnswer(5, 'b')">b) Weights and the full covariance structure</button>
                        <button onclick="checkAnswer(5, 'c')">c) Only correlations</button>
                        <button onclick="checkAnswer(5, 'd')">d) Only expected returns</button>
                    </div>
                    <div class="quiz-feedback" id="feedback5"></div>
                </div>

                <div class="score-container" id="scoreContainer">
                    <h3>Quiz Complete! Score: <span id="finalScore">0</span>/5</h3>
                </div>
            </div>
        </section>
    </main>

    <script>
        // Quiz
        const correctAnswers = { 1: 'b', 2: 'b', 3: 'c', 4: 'b', 5: 'b' };
        const explanations = {
            1: { 'a': 'Not all portfolios‚Äîonly optimal ones.', 'b': 'Correct! Maximum return for each risk level (or minimum risk for each return level).', 'c': 'That\'s just one point, not a frontier.', 'd': 'Equal weights are usually suboptimal.' },
            2: { 'a': 'Opposite! Correlation = 1 eliminates benefits.', 'b': 'Correct! Perfect correlation means no diversification benefit.', 'c': 'Risk is never eliminated through diversification.', 'd': 'Correlation doesn\'t affect expected returns.' },
            3: { 'a': 'Min variance is different‚Äîlowest risk point.', 'b': 'Max return ignores risk.', 'c': 'Correct! Tangent to efficient frontier from risk-free rate.', 'd': 'Equal weights are rarely optimal.' },
            4: { 'a': 'The math is correct; inputs are the problem.', 'b': 'Correct! Estimation error in covariances leads to unstable portfolios.', 'c': 'Market efficiency is unrelated.', 'd': 'Computation is fast; estimation is the issue.' },
            5: { 'a': 'Covariances also matter!', 'b': 'Correct! Both weights and full covariance matrix (variances + covariances).', 'c': 'Variances also matter.', 'd': 'Returns don\'t affect variance.' }
        };
        let quizAnswers = {};

        function checkAnswer(q, a) {
            const feedback = document.getElementById(`feedback${q}`);
            const isCorrect = a === correctAnswers[q];
            quizAnswers[q] = a;
            feedback.innerHTML = `<div class="${isCorrect ? 'correct' : 'incorrect'}">${isCorrect ? '‚úì Correct!' : '‚úó Incorrect.'} ${explanations[q][a]}</div>`;
            feedback.style.display = 'block';
            document.querySelectorAll(`#q${q} button`).forEach(btn => btn.disabled = true);
            if (Object.keys(quizAnswers).length === 5) {
                const score = Object.keys(quizAnswers).reduce((sum, q) => sum + (quizAnswers[q] === correctAnswers[q] ? 1 : 0), 0);
                document.getElementById('finalScore').textContent = score;
                document.getElementById('scoreContainer').style.display = 'block';
            }
        }

        // Portfolio Optimization (simplified for browser)
        function optimizePortfolio() {
            const ret = [parseFloat(document.getElementById('ret1').value)/100, parseFloat(document.getElementById('ret2').value)/100, parseFloat(document.getElementById('ret3').value)/100];
            const vol = [parseFloat(document.getElementById('vol1').value)/100, parseFloat(document.getElementById('vol2').value)/100, parseFloat(document.getElementById('vol3').value)/100];
            const corr12 = parseFloat(document.getElementById('corr12').value);
            const corr13 = parseFloat(document.getElementById('corr13').value);
            const corr23 = parseFloat(document.getElementById('corr23').value);

            // Simple grid search for max Sharpe
            let bestSharpe = -Infinity, bestWeights = [1/3, 1/3, 1/3];
            const rf = 0.02;

            for (let w1 = 0; w1 <= 1; w1 += 0.05) {
                for (let w2 = 0; w2 <= 1 - w1; w2 += 0.05) {
                    const w3 = 1 - w1 - w2;
                    const portRet = w1*ret[0] + w2*ret[1] + w3*ret[2];
                    const portVar = w1*w1*vol[0]*vol[0] + w2*w2*vol[1]*vol[1] + w3*w3*vol[2]*vol[2] +
                                   2*w1*w2*vol[0]*vol[1]*corr12 + 2*w1*w3*vol[0]*vol[2]*corr13 + 2*w2*w3*vol[1]*vol[2]*corr23;
                    const portVol = Math.sqrt(portVar);
                    const sharpe = (portRet - rf) / portVol;
                    if (sharpe > bestSharpe) {
                        bestSharpe = sharpe;
                        bestWeights = [w1, w2, w3];
                    }
                }
            }

            const portRet = bestWeights[0]*ret[0] + bestWeights[1]*ret[1] + bestWeights[2]*ret[2];
            const portVar = bestWeights[0]**2*vol[0]**2 + bestWeights[1]**2*vol[1]**2 + bestWeights[2]**2*vol[2]**2 +
                           2*bestWeights[0]*bestWeights[1]*vol[0]*vol[1]*corr12 +
                           2*bestWeights[0]*bestWeights[2]*vol[0]*vol[2]*corr13 +
                           2*bestWeights[1]*bestWeights[2]*vol[1]*vol[2]*corr23;
            const portVol = Math.sqrt(portVar);

            document.getElementById('resultsContainer').style.display = 'block';
            document.getElementById('weightsDisplay').innerHTML = `
                <div class="weight-badge">Asset 1: <span>${(bestWeights[0]*100).toFixed(1)}%</span></div>
                <div class="weight-badge">Asset 2: <span>${(bestWeights[1]*100).toFixed(1)}%</span></div>
                <div class="weight-badge">Asset 3: <span>${(bestWeights[2]*100).toFixed(1)}%</span></div>
            `;
            document.getElementById('optReturn').textContent = (portRet*100).toFixed(2) + '%';
            document.getElementById('optVol').textContent = (portVol*100).toFixed(2) + '%';
            document.getElementById('optSharpe').textContent = bestSharpe.toFixed(2);
        }

        // Chart
        function initChart() {
            const ctx = document.getElementById('efficientFrontierChart').getContext('2d');
            const frontierPoints = [];
            const assetPoints = [{x: 20, y: 12}, {x: 10, y: 7}, {x: 5, y: 4}];

            for (let vol = 5; vol <= 20; vol += 0.5) {
                const ret = 4 + (vol - 5) * 0.6 - (vol - 12) ** 2 * 0.01;
                frontierPoints.push({x: vol, y: ret});
            }

            new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Efficient Frontier',
                        data: frontierPoints,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        showLine: true,
                        fill: false,
                        tension: 0.4,
                        pointRadius: 0
                    }, {
                        label: 'Individual Assets',
                        data: assetPoints,
                        backgroundColor: ['#ef4444', '#22c55e', '#f59e0b'],
                        pointRadius: 10,
                        pointStyle: 'circle'
                    }, {
                        label: 'Tangency Portfolio',
                        data: [{x: 12, y: 9.5}],
                        backgroundColor: '#8b5cf6',
                        pointRadius: 12,
                        pointStyle: 'star'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: false,
                    plugins: { legend: { labels: { color: '#94a3b8' } } },
                    scales: {
                        x: { min: 0, max: 25, title: { display: true, text: 'Volatility (%)', color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#64748b' } },
                        y: { min: 0, max: 15, title: { display: true, text: 'Expected Return (%)', color: '#94a3b8' }, grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#64748b' } }
                    }
                }
            });
        }

        function copyCode(btn) {
            const code = btn.closest('.code-block').querySelector('code').textContent;
            navigator.clipboard.writeText(code);
            btn.textContent = 'Copied!';
            setTimeout(() => btn.textContent = 'Copy', 2000);
        }

        document.addEventListener('DOMContentLoaded', function() { initChart(); optimizePortfolio(); });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
</body>
</html>
